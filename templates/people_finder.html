<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>People Finder - ZoolZ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #0a0e1a;
            color: #fff;
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* Animated neon blue crosshatch grid background */
        .grid-background {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background:
                linear-gradient(90deg, transparent 48%, rgba(0, 149, 255, 0.15) 49%, rgba(0, 149, 255, 0.15) 51%, transparent 52%),
                linear-gradient(0deg, transparent 48%, rgba(0, 149, 255, 0.15) 49%, rgba(0, 149, 255, 0.15) 51%, transparent 52%),
                linear-gradient(135deg, transparent 48%, rgba(0, 200, 255, 0.08) 49%, rgba(0, 200, 255, 0.08) 51%, transparent 52%),
                linear-gradient(45deg, transparent 48%, rgba(0, 200, 255, 0.08) 49%, rgba(0, 200, 255, 0.08) 51%, transparent 52%);
            background-size: 50px 50px, 50px 50px, 50px 50px, 50px 50px;
            background-position: 0 0, 0 0, 0 0, 0 0;
            animation: gridPulse 8s ease-in-out infinite;
            z-index: 0;
        }

        @keyframes gridPulse {
            0%, 100% { opacity: 0.6; }
            50% { opacity: 1; }
        }

        .container {
            position: relative;
            z-index: 1;
            max-width: 1400px;
            margin: 0 auto;
            padding: 40px 20px;
        }

        /* Header */
        .header {
            text-align: center;
            margin-bottom: 40px;
            position: relative;
        }

        .header h1 {
            font-size: 3rem;
            font-weight: 700;
            background: linear-gradient(135deg, #0095ff, #00c8ff, #0095ff);
            background-size: 200% 200%;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: titleShimmer 4s ease-in-out infinite;
            margin-bottom: 10px;
        }

        @keyframes titleShimmer {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }

        .header p {
            color: #8ab4f8;
            font-size: 1.1rem;
        }

        .back-to-hub {
            position: absolute;
            top: 0;
            left: 0;
            background: rgba(0, 149, 255, 0.2);
            border: 1px solid #0095ff;
            color: #fff;
            padding: 10px 20px;
            border-radius: 5px;
            text-decoration: none;
            transition: all 0.3s;
        }

        .back-to-hub:hover {
            background: rgba(0, 149, 255, 0.4);
            box-shadow: 0 0 15px rgba(0, 149, 255, 0.5);
        }

        /* Search Card */
        .search-card {
            background: rgba(0, 149, 255, 0.05);
            border: 1px solid rgba(0, 149, 255, 0.3);
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 0 20px rgba(0, 149, 255, 0.2);
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-group label {
            color: #8ab4f8;
            font-weight: 600;
            margin-bottom: 8px;
            display: block;
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 12px;
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(0, 149, 255, 0.3);
            border-radius: 8px;
            color: #fff;
            font-size: 1rem;
            transition: all 0.3s;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #0095ff;
            box-shadow: 0 0 15px rgba(0, 149, 255, 0.3);
        }

        .form-group input::placeholder {
            color: #666;
        }

        .search-btn {
            background: linear-gradient(135deg, #0095ff, #00c8ff);
            border: none;
            color: #fff;
            padding: 15px 40px;
            border-radius: 8px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(0, 149, 255, 0.3);
            width: 100%;
        }

        .search-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 149, 255, 0.5);
        }

        .search-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .example-btn {
            background: rgba(0, 149, 255, 0.2);
            border: 1px solid #0095ff;
            color: #fff;
            padding: 15px 30px;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            margin-top: 10px;
        }

        .example-btn:hover {
            background: rgba(0, 149, 255, 0.4);
        }

        /* Settings Button */
        .settings-btn {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(0, 149, 255, 0.3);
            border: 1px solid #0095ff;
            color: #fff;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
            box-shadow: 0 0 20px rgba(0, 149, 255, 0.3);
            z-index: 1000;
        }

        .settings-btn:hover {
            background: rgba(0, 149, 255, 0.5);
            box-shadow: 0 0 30px rgba(0, 149, 255, 0.5);
            transform: scale(1.1);
        }

        /* Progress Bars */
        .progress-container {
            display: none;
            margin-top: 20px;
        }

        .progress-label {
            color: #8ab4f8;
            margin-bottom: 8px;
            font-weight: 500;
        }

        .progress-bar {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            overflow: hidden;
            height: 30px;
            margin-bottom: 15px;
            border: 1px solid rgba(0, 149, 255, 0.3);
        }

        .progress-fill {
            background: linear-gradient(90deg, #0095ff, #00c8ff);
            height: 100%;
            width: 0%;
            transition: width 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #fff;
            font-weight: 600;
            font-size: 0.9rem;
        }

        /* Results */
        .results-container {
            display: none;
        }

        .results-summary {
            background: rgba(0, 149, 255, 0.05);
            border: 1px solid rgba(0, 149, 255, 0.3);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
        }

        .results-summary h2 {
            color: #00c8ff;
            margin-bottom: 15px;
        }

        .person-card {
            background: rgba(0, 149, 255, 0.05);
            border: 1px solid rgba(0, 149, 255, 0.3);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .person-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0, 149, 255, 0.3);
            border-color: #0095ff;
        }

        .person-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            border-bottom: 2px solid rgba(0, 149, 255, 0.3);
            padding-bottom: 15px;
        }

        .person-name {
            font-size: 1.8rem;
            font-weight: 700;
            color: #00c8ff;
        }

        .confidence-badge {
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 600;
            display: flex;
            flex-direction: column;
            gap: 5px;
            min-width: 140px;
        }

        .confidence-high {
            background: linear-gradient(135deg, #4CAF50, #45a049);
            color: white;
            box-shadow: 0 2px 10px rgba(76, 175, 80, 0.4);
        }

        .confidence-medium {
            background: linear-gradient(135deg, #FFC107, #FFB300);
            color: #000;
            box-shadow: 0 2px 10px rgba(255, 193, 7, 0.4);
        }

        .confidence-low {
            background: linear-gradient(135deg, #ff9800, #F57C00);
            color: white;
            box-shadow: 0 2px 10px rgba(255, 152, 0, 0.4);
        }

        .confidence-progress-bar {
            width: 100%;
            height: 6px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            overflow: hidden;
            position: relative;
        }

        .confidence-progress-fill {
            height: 100%;
            background: white;
            border-radius: 10px;
            transition: width 0.6s ease-out;
            box-shadow: 0 0 8px rgba(255, 255, 255, 0.5);
        }

        .ml-verified-badge {
            font-size: 0.7rem;
            background: rgba(138, 43, 226, 0.5);
            padding: 2px 6px;
            border-radius: 8px;
            display: inline-block;
            margin-top: 3px;
        }

        .person-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
        }

        .summary-item {
            text-align: center;
        }

        .summary-label {
            font-size: 0.85rem;
            color: #8ab4f8;
            margin-bottom: 5px;
        }

        .summary-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: #00c8ff;
        }

        /* Details */
        .person-details {
            display: none;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 2px solid rgba(0, 149, 255, 0.3);
        }

        .person-details.active {
            display: block;
        }

        .detail-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .detail-tab {
            padding: 10px 20px;
            background: rgba(0, 149, 255, 0.1);
            border: 1px solid rgba(0, 149, 255, 0.3);
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            color: #8ab4f8;
            transition: all 0.3s;
        }

        .detail-tab.active {
            background: linear-gradient(135deg, #0095ff, #00c8ff);
            color: white;
            border-color: #0095ff;
        }

        .detail-content {
            display: none;
        }

        .detail-content.active {
            display: block;
        }

        .data-list {
            list-style: none;
        }

        .data-item {
            padding: 15px;
            background: rgba(0, 0, 0, 0.3);
            border-left: 4px solid #0095ff;
            margin-bottom: 10px;
            border-radius: 5px;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: #0a0e1a;
            border: 1px solid rgba(0, 149, 255, 0.3);
            border-radius: 15px;
            padding: 30px;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 0 30px rgba(0, 149, 255, 0.3);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            border-bottom: 2px solid rgba(0, 149, 255, 0.3);
            padding-bottom: 15px;
        }

        .modal-header h2 {
            color: #00c8ff;
            margin: 0;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 2rem;
            color: #8ab4f8;
            cursor: pointer;
        }

        .close-btn:hover {
            color: #00c8ff;
        }

        .api-section {
            margin-bottom: 25px;
            padding: 20px;
            background: rgba(0, 149, 255, 0.05);
            border: 1px solid rgba(0, 149, 255, 0.2);
            border-radius: 10px;
        }

        .api-section h3 {
            color: #00c8ff;
            margin-bottom: 10px;
        }

        .api-section p {
            color: #8ab4f8;
            margin-bottom: 10px;
            line-height: 1.5;
        }

        .api-section input {
            width: 100%;
            padding: 12px;
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(0, 149, 255, 0.3);
            border-radius: 8px;
            color: #fff;
            margin-bottom: 5px;
        }

        .api-section input:focus {
            outline: none;
            border-color: #0095ff;
            box-shadow: 0 0 10px rgba(0, 149, 255, 0.3);
        }

        .save-settings-btn {
            background: linear-gradient(135deg, #0095ff, #00c8ff);
            border: none;
            color: #fff;
            padding: 12px 30px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            width: 100%;
            margin-top: 20px;
        }

        .save-settings-btn:hover {
            opacity: 0.9;
        }

        .error-alert {
            background: rgba(244, 67, 54, 0.1);
            border-left: 4px solid #f44336;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            color: #ff6b6b;
        }

        .back-btn {
            background: rgba(0, 149, 255, 0.2);
            border: 1px solid #0095ff;
            color: #fff;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            margin-bottom: 20px;
        }

        .back-btn:hover {
            background: rgba(0, 149, 255, 0.4);
        }

        /* Tables */
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }

        th, td {
            padding: 12px;
            text-align: left;
            border: 1px solid rgba(0, 149, 255, 0.3);
        }

        th {
            background: rgba(0, 149, 255, 0.1);
            color: #00c8ff;
            font-weight: 600;
        }

        td {
            background: rgba(0, 0, 0, 0.2);
        }

        tr:hover td {
            background: rgba(0, 149, 255, 0.05);
        }

        a {
            color: #00c8ff;
            text-decoration: none;
        }

        a:hover {
            text-decoration: underline;
        }

        small {
            color: #8ab4f8;
        }

        /* State checkbox styling */
        .state-checkbox-label {
            display: flex;
            align-items: center;
            cursor: pointer;
            padding: 8px;
            background: rgba(0, 149, 255, 0.1);
            border: 1px solid rgba(0, 149, 255, 0.2);
            border-radius: 5px;
            transition: all 0.3s;
        }

        .state-checkbox-label:hover {
            background: rgba(0, 149, 255, 0.2);
            border-color: rgba(0, 149, 255, 0.4);
            transform: translateY(-1px);
        }

        .state-checkbox-label input:checked ~ span {
            font-weight: 700;
            color: #00c8ff;
        }

        /* Bookmark/Save button styling */
        .save-person-btn {
            background: linear-gradient(135deg, #4CAF50, #45a049);
            border: none;
            color: white;
            padding: 10px 20px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            margin-left: 10px;
        }

        .save-person-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(76, 175, 80, 0.4);
        }

        .save-person-btn.saved {
            background: linear-gradient(135deg, #FF9800, #F57C00);
        }

        .saved-people-section {
            margin-top: 30px;
            display: none;
        }

        .saved-people-section.active {
            display: block;
        }

        .view-saved-btn {
            background: rgba(76, 175, 80, 0.2);
            border: 1px solid #4CAF50;
            color: #fff;
            padding: 12px 25px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            margin-left: 10px;
            transition: all 0.3s;
        }

        .view-saved-btn:hover {
            background: rgba(76, 175, 80, 0.4);
        }

        .person-location-badge {
            display: inline-block;
            padding: 4px 10px;
            background: rgba(0, 149, 255, 0.2);
            border: 1px solid rgba(0, 149, 255, 0.4);
            border-radius: 12px;
            font-size: 0.85em;
            margin-left: 10px;
        }

        /* ML Insights Panel */
        .ml-insights-panel {
            background: linear-gradient(135deg, rgba(138, 43, 226, 0.1), rgba(0, 149, 255, 0.1));
            border: 2px solid rgba(138, 43, 226, 0.4);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: 0 0 20px rgba(138, 43, 226, 0.3);
            animation: mlGlow 3s ease-in-out infinite;
        }

        @keyframes mlGlow {
            0%, 100% { box-shadow: 0 0 20px rgba(138, 43, 226, 0.3); }
            50% { box-shadow: 0 0 30px rgba(138, 43, 226, 0.5); }
        }

        .ml-insights-panel h3 {
            color: #ba55d3;
            font-size: 1.5rem;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .ml-insights-panel .brain-icon {
            font-size: 1.8rem;
            animation: brainPulse 2s ease-in-out infinite;
        }

        @keyframes brainPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        .ml-insight-item {
            background: rgba(0, 0, 0, 0.3);
            border-left: 3px solid #ba55d3;
            padding: 12px 15px;
            margin-bottom: 12px;
            border-radius: 8px;
            color: #e0e0ff;
            display: flex;
            align-items: center;
            gap: 12px;
            transition: all 0.3s;
        }

        .ml-insight-item:hover {
            background: rgba(0, 0, 0, 0.5);
            border-left-color: #0095ff;
            transform: translateX(5px);
        }

        .ml-insight-icon {
            font-size: 1.2rem;
            min-width: 24px;
        }

        .ml-insight-text {
            flex: 1;
        }

        .ml-insight-badge {
            background: rgba(138, 43, 226, 0.3);
            color: #fff;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.85em;
            font-weight: 600;
        }

        .ml-disabled-message {
            color: #8ab4f8;
            text-align: center;
            padding: 15px;
            font-style: italic;
        }

        /* ML Activation Lever & Perimeter Lighting */
        .ml-control-panel {
            position: fixed;
            top: 90px;
            right: 20px;
            z-index: 1999;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
        }

        .ml-lever-container {
            background: linear-gradient(145deg, #1a1f2e, #0a0e1a);
            border: 2px solid rgba(0, 149, 255, 0.3);
            border-radius: 15px;
            padding: 15px 20px;
            box-shadow:
                0 4px 15px rgba(0, 0, 0, 0.5),
                inset 0 1px 3px rgba(255, 255, 255, 0.1);
            position: relative;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .ml-lever-container.active {
            border-color: #00ff88;
            box-shadow:
                0 4px 20px rgba(0, 255, 136, 0.4),
                inset 0 1px 3px rgba(0, 255, 136, 0.2);
        }

        .ml-lever-container:hover {
            transform: translateY(-2px);
            box-shadow:
                0 6px 20px rgba(0, 149, 255, 0.4),
                inset 0 1px 3px rgba(255, 255, 255, 0.1);
        }

        .ml-lever-label {
            text-align: center;
            font-size: 0.7rem;
            font-weight: 700;
            color: #8ab4f8;
            letter-spacing: 1px;
            margin-bottom: 8px;
            text-transform: uppercase;
        }

        .ml-lever-container.active .ml-lever-label {
            color: #00ff88;
            text-shadow: 0 0 8px rgba(0, 255, 136, 0.6);
        }

        .ml-lever-switch {
            position: relative;
            width: 70px;
            height: 35px;
            background: linear-gradient(180deg, #2a2f3e, #1a1f2e);
            border-radius: 20px;
            border: 2px solid rgba(0, 149, 255, 0.4);
            box-shadow: inset 0 2px 8px rgba(0, 0, 0, 0.6);
            transition: all 0.4s ease;
        }

        .ml-lever-container.active .ml-lever-switch {
            background: linear-gradient(180deg, #00ff88, #00cc66);
            border-color: #00ff88;
            box-shadow:
                inset 0 2px 8px rgba(0, 0, 0, 0.3),
                0 0 15px rgba(0, 255, 136, 0.6);
        }

        .ml-lever-handle {
            position: absolute;
            top: 3px;
            left: 3px;
            width: 25px;
            height: 25px;
            background: linear-gradient(145deg, #4a5568, #2d3748);
            border-radius: 50%;
            border: 2px solid rgba(0, 149, 255, 0.6);
            box-shadow:
                0 2px 8px rgba(0, 0, 0, 0.5),
                inset 0 1px 2px rgba(255, 255, 255, 0.2);
            transition: all 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
        }

        .ml-lever-container.active .ml-lever-handle {
            left: 38px;
            background: linear-gradient(145deg, #00ff88, #00cc66);
            border-color: #ffffff;
            box-shadow:
                0 0 15px rgba(0, 255, 136, 0.8),
                inset 0 1px 2px rgba(255, 255, 255, 0.3);
        }

        .ml-status-text {
            font-size: 0.65rem;
            font-weight: 700;
            color: #8ab4f8;
            margin-top: 5px;
            text-align: center;
            letter-spacing: 0.5px;
        }

        .ml-lever-container.active .ml-status-text {
            color: #00ff88;
            text-shadow: 0 0 8px rgba(0, 255, 136, 0.6);
        }

        /* Perimeter Neon Tube (Behind Screen Edge) - ML Active */
        .ml-perimeter-border {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            pointer-events: none;
            z-index: 0;  /* BEHIND everything */
            opacity: 0;
            transition: opacity 0.5s ease;
        }

        .ml-perimeter-border.active {
            opacity: 1;
        }

        /* Neon tube effect - multiple layers for depth */
        .ml-perimeter-border::before {
            content: '';
            position: absolute;
            top: -8px;
            left: -8px;
            right: -8px;
            bottom: -8px;
            border: 4px solid #00ff88;
            border-radius: 2px;
            box-shadow:
                /* Inner glow (from tube) */
                inset 0 0 15px rgba(0, 255, 136, 0.6),
                inset 0 0 30px rgba(0, 255, 136, 0.3),
                /* Outer glow (light spill) */
                0 0 20px rgba(0, 255, 136, 0.8),
                0 0 40px rgba(0, 255, 136, 0.4),
                0 0 60px rgba(0, 255, 136, 0.2);
            animation: neonTubePulse 3s ease-in-out infinite;
        }

        /* Secondary glow layer for more depth */
        .ml-perimeter-border::after {
            content: '';
            position: absolute;
            top: -12px;
            left: -12px;
            right: -12px;
            bottom: -12px;
            border: 2px solid rgba(0, 255, 136, 0.3);
            border-radius: 4px;
            box-shadow:
                0 0 30px rgba(0, 255, 136, 0.3),
                0 0 60px rgba(0, 255, 136, 0.15);
            animation: neonTubePulse 3s ease-in-out infinite 0.5s;  /* Offset animation */
        }

        @keyframes neonTubePulse {
            0%, 100% {
                opacity: 0.8;
                box-shadow:
                    inset 0 0 15px rgba(0, 255, 136, 0.6),
                    inset 0 0 30px rgba(0, 255, 136, 0.3),
                    0 0 20px rgba(0, 255, 136, 0.8),
                    0 0 40px rgba(0, 255, 136, 0.4),
                    0 0 60px rgba(0, 255, 136, 0.2);
            }
            50% {
                opacity: 1;
                box-shadow:
                    inset 0 0 20px rgba(0, 255, 136, 0.8),
                    inset 0 0 40px rgba(0, 255, 136, 0.5),
                    0 0 30px rgba(0, 255, 136, 1),
                    0 0 60px rgba(0, 255, 136, 0.6),
                    0 0 90px rgba(0, 255, 136, 0.3);
            }
        }

        /* Activation Beam Animation */
        .activation-beam {
            position: fixed;
            top: 0;
            left: 0;
            width: 4px;
            height: 4px;
            background: #00ff88;
            border-radius: 50%;
            box-shadow: 0 0 15px rgba(0, 255, 136, 1);
            pointer-events: none;
            z-index: 10000;
            opacity: 0;
        }

        .activation-beam.animating {
            opacity: 1;
            animation: beamRace 1.5s ease-in-out;
        }

        @keyframes beamRace {
            0% {
                top: 0;
                left: 0;
                box-shadow: 0 0 20px rgba(0, 255, 136, 1);
            }
            25% {
                top: 0;
                left: 100%;
                box-shadow: 0 0 20px rgba(0, 255, 136, 1);
            }
            50% {
                top: 100%;
                left: 100%;
                box-shadow: 0 0 20px rgba(0, 255, 136, 1);
            }
            75% {
                top: 100%;
                left: 0;
                box-shadow: 0 0 20px rgba(0, 255, 136, 1);
            }
            100% {
                top: 0;
                left: 0;
                opacity: 0;
            }
        }

        /* ML Unavailable Warning */
        .ml-unavailable-badge {
            background: rgba(255, 152, 0, 0.2);
            border: 1px solid #ff9800;
            color: #ff9800;
            padding: 4px 8px;
            border-radius: 8px;
            font-size: 0.6rem;
            font-weight: 700;
            text-align: center;
            margin-top: 5px;
        }

        /* Dataset Intelligence Lever (Orange/Amber) */
        .dataset-lever-container {
            background: linear-gradient(145deg, #1a1f2e, #0a0e1a);
            border: 2px solid rgba(255, 152, 0, 0.3);
            border-radius: 15px;
            padding: 15px 20px;
            box-shadow:
                0 4px 15px rgba(0, 0, 0, 0.5),
                inset 0 1px 3px rgba(255, 255, 255, 0.1);
            position: relative;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .dataset-lever-container.active {
            border-color: #ff9800;
            box-shadow:
                0 4px 20px rgba(255, 152, 0, 0.4),
                inset 0 1px 3px rgba(255, 152, 0, 0.2);
        }

        .dataset-lever-container:hover {
            transform: translateY(-2px);
            box-shadow:
                0 6px 20px rgba(255, 152, 0, 0.4),
                inset 0 1px 3px rgba(255, 255, 255, 0.1);
        }

        .dataset-lever-label {
            text-align: center;
            font-size: 0.7rem;
            font-weight: 700;
            color: #ffa726;
            letter-spacing: 1px;
            margin-bottom: 8px;
            text-transform: uppercase;
        }

        .dataset-lever-container.active .dataset-lever-label {
            color: #ff9800;
            text-shadow: 0 0 8px rgba(255, 152, 0, 0.6);
        }

        .dataset-lever-switch {
            position: relative;
            width: 70px;
            height: 35px;
            background: linear-gradient(180deg, #2a2f3e, #1a1f2e);
            border-radius: 20px;
            border: 2px solid rgba(255, 152, 0, 0.4);
            box-shadow: inset 0 2px 8px rgba(0, 0, 0, 0.6);
            transition: all 0.4s ease;
        }

        .dataset-lever-container.active .dataset-lever-switch {
            background: linear-gradient(180deg, #ff9800, #f57c00);
            border-color: #ff9800;
            box-shadow:
                inset 0 2px 8px rgba(0, 0, 0, 0.3),
                0 0 15px rgba(255, 152, 0, 0.6);
        }

        .dataset-lever-handle {
            position: absolute;
            top: 3px;
            left: 3px;
            width: 25px;
            height: 25px;
            background: linear-gradient(145deg, #4a5568, #2d3748);
            border-radius: 50%;
            border: 2px solid rgba(255, 152, 0, 0.6);
            box-shadow:
                0 2px 8px rgba(0, 0, 0, 0.5),
                inset 0 1px 2px rgba(255, 255, 255, 0.2);
            transition: all 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
        }

        .dataset-lever-container.active .dataset-lever-handle {
            left: 38px;
            background: linear-gradient(145deg, #ff9800, #f57c00);
            border-color: #ffffff;
            box-shadow:
                0 0 15px rgba(255, 152, 0, 0.8),
                inset 0 1px 2px rgba(255, 255, 255, 0.3);
        }

        .dataset-status-text {
            font-size: 0.65rem;
            font-weight: 700;
            color: #ffa726;
            margin-top: 5px;
            text-align: center;
            letter-spacing: 0.5px;
        }

        .dataset-lever-container.active .dataset-status-text {
            color: #ff9800;
            text-shadow: 0 0 8px rgba(255, 152, 0, 0.6);
        }

        /* Control Panel Divider */
        .control-panel-divider {
            width: 100%;
            height: 1px;
            background: linear-gradient(90deg, transparent, rgba(0, 149, 255, 0.3), transparent);
            margin: 10px 0;
        }

        /* Control Panel Header */
        .control-panel-header {
            text-align: center;
            font-size: 0.65rem;
            font-weight: 700;
            color: #8ab4f8;
            letter-spacing: 2px;
            text-transform: uppercase;
            margin-bottom: 10px;
            opacity: 0.7;
        }
    </style>
</head>
<body>
    <div class="grid-background"></div>

    <!-- ML Perimeter Border (glows green when ML active) -->
    <div class="ml-perimeter-border" id="mlPerimeterBorder"></div>

    <!-- Activation Beam (animates around screen when toggling) -->
    <div class="activation-beam" id="activationBeam"></div>

    <!-- Settings Button -->
    <button class="settings-btn" onclick="openSettings()" title="API Settings">
        ‚öôÔ∏è
    </button>

    <!-- Tactical Control Panel (ML + Datasets) -->
    <div class="ml-control-panel">
        <div class="control-panel-header">‚ö° INTELLIGENCE CORE ‚ö°</div>

        <!-- ML/NLP Activation Lever -->
        <div class="ml-lever-container" id="mlLeverContainer" onclick="toggleMLActivation()" title="Toggle ML/NLP Features">
            <div class="ml-lever-label">üß† ML/NLP</div>
            <div class="ml-lever-switch">
                <div class="ml-lever-handle"></div>
            </div>
            <div class="ml-status-text" id="mlStatusText">STANDBY</div>
        </div>

        <div class="control-panel-divider"></div>

        <!-- Dataset Intelligence Lever -->
        <div class="dataset-lever-container" id="datasetLeverContainer" onclick="toggleDatasetIntelligence()" title="Engage Historical Dataset Intelligence">
            <div class="dataset-lever-label">üìä DATASETS</div>
            <div class="dataset-lever-switch">
                <div class="dataset-lever-handle"></div>
            </div>
            <div class="dataset-status-text" id="datasetStatusText">OFFLINE</div>
        </div>
    </div>

    <!-- Settings Modal -->
    <div class="modal" id="settingsModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>‚öôÔ∏è API Settings</h2>
                <button class="close-btn" onclick="closeSettings()">&times;</button>
            </div>

            <div class="api-section">
                <h3>üîç Google Custom Search API (Optional)</h3>
                <p>Enhances web and social media searches. Free tier: 100 queries/day.</p>
                <input type="text" id="googleApiKey" placeholder="Enter Google API Key">
                <input type="text" id="googleSearchEngineId" placeholder="Enter Search Engine ID">
                <small>Get free API key at: <a href="https://developers.google.com/custom-search" target="_blank">developers.google.com/custom-search</a></small>
            </div>

            <div class="api-section">
                <h3>üì± NumVerify Phone API (Optional)</h3>
                <p>Enhances phone validation with carrier info. Free tier: 250 lookups/month.</p>
                <input type="text" id="numverifyApiKey" placeholder="Enter NumVerify API Key">
                <small>Get free API key at: <a href="https://numverify.com/product" target="_blank">numverify.com/product</a></small>
            </div>

            <p style="color: #8ab4f8; margin-top: 20px;">
                <strong>Note:</strong> API keys are stored locally in your browser. The People Finder works without API keys, but results will be more limited.
            </p>

            <button class="save-settings-btn" onclick="saveSettings()">
                üíæ Save Settings
            </button>
        </div>
    </div>

    <div class="container">
        <div class="header">
            <a href="/" class="back-to-hub">‚Üê Back to Hub</a>
            <h1>üîç People Finder</h1>
            <p>Comprehensive people search using public records, phone lookup, and web search</p>
            <button class="view-saved-btn" onclick="toggleSavedPeople()" id="viewSavedBtn">
                üìÅ View Saved (<span id="savedCount">0</span>)
            </button>
        </div>

        <!-- Search Form -->
        <div class="search-card">
            <form id="searchForm">
                <div class="form-row">
                    <div class="form-group">
                        <label for="name">Full Name</label>
                        <input type="text" id="name" name="name" placeholder="John Smith">
                    </div>
                    <div class="form-group">
                        <label for="phone">Phone Number</label>
                        <input type="tel" id="phone" name="phone" placeholder="(123) 456-7890">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="address">Address</label>
                        <input type="text" id="address" name="address" placeholder="123 Main St">
                    </div>
                    <div class="form-group">
                        <label for="email">Email Address</label>
                        <input type="email" id="email" name="email" placeholder="john@example.com">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>States to Search (Select Multiple)</label>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 10px; margin-top: 10px;">
                            <label class="state-checkbox-label">
                                <input type="checkbox" name="states" value="OH" class="state-checkbox" onchange="updateCountyOptions()" style="margin-right: 8px; width: 18px; height: 18px; cursor: pointer;">
                                <span>Ohio (88 counties)</span>
                            </label>
                            <label class="state-checkbox-label">
                                <input type="checkbox" name="states" value="PA" class="state-checkbox" onchange="updateCountyOptions()" style="margin-right: 8px; width: 18px; height: 18px; cursor: pointer;">
                                <span>Pennsylvania (67 counties)</span>
                            </label>
                            <label class="state-checkbox-label">
                                <input type="checkbox" name="states" value="WV" class="state-checkbox" onchange="updateCountyOptions()" style="margin-right: 8px; width: 18px; height: 18px; cursor: pointer;">
                                <span>West Virginia (55 counties)</span>
                            </label>
                            <label class="state-checkbox-label">
                                <input type="checkbox" name="states" value="IN" class="state-checkbox" onchange="updateCountyOptions()" style="margin-right: 8px; width: 18px; height: 18px; cursor: pointer;">
                                <span>Indiana</span>
                            </label>
                            <label class="state-checkbox-label">
                                <input type="checkbox" name="states" value="IL" class="state-checkbox" onchange="updateCountyOptions()" style="margin-right: 8px; width: 18px; height: 18px; cursor: pointer;">
                                <span>Illinois</span>
                            </label>
                            <label class="state-checkbox-label">
                                <input type="checkbox" name="states" value="KY" class="state-checkbox" onchange="updateCountyOptions()" style="margin-right: 8px; width: 18px; height: 18px; cursor: pointer;">
                                <span>Kentucky</span>
                            </label>
                            <label class="state-checkbox-label">
                                <input type="checkbox" name="states" value="TN" class="state-checkbox" onchange="updateCountyOptions()" style="margin-right: 8px; width: 18px; height: 18px; cursor: pointer;">
                                <span>Tennessee</span>
                            </label>
                        </div>
                        <small style="color: #8ab4f8; margin-top: 8px; display: block;">Leave unchecked to search OH, PA, WV by default</small>
                    </div>
                    <div class="form-group">
                        <label for="county">County (Optional - Single State Only)</label>
                        <select id="county" name="county" disabled>
                            <option value="">Select one state first...</option>
                        </select>
                        <small style="color: #8ab4f8; margin-top: 8px; display: block;">County filter only works when one state is selected</small>
                    </div>
                </div>

                <div style="display: flex; gap: 10px;">
                    <button type="submit" class="search-btn" id="searchBtn">
                        üîé Search
                    </button>
                    <button type="button" class="example-btn" onclick="fillExampleData()">
                        ‚ú® Try Example
                    </button>
                </div>

                <!-- Progress Bars -->
                <div class="progress-container" id="progressContainer">
                    <div>
                        <div class="progress-label">Official Records & Phone Validation</div>
                        <div class="progress-bar">
                            <div class="progress-fill" id="progress1">0%</div>
                        </div>
                    </div>
                    <div>
                        <div class="progress-label">Web Search & Social Media</div>
                        <div class="progress-bar">
                            <div class="progress-fill" id="progress2">0%</div>
                        </div>
                    </div>

                    <!-- Real-Time Search Log Display -->
                    <div style="margin-top: 20px; background: rgba(0, 0, 0, 0.5); border: 1px solid rgba(0, 149, 255, 0.3); border-radius: 10px; padding: 15px; max-height: 400px; overflow-y: auto;">
                        <h3 style="color: #00c8ff; margin: 0 0 15px 0; font-size: 1.1rem;">üîç Search Activity Log</h3>
                        <div id="searchLog" style="font-family: 'Courier New', monospace; font-size: 0.9rem; line-height: 1.6;">
                            <div style="color: #8ab4f8;">Waiting to start search...</div>
                        </div>
                    </div>
                </div>
            </form>
        </div>

        <!-- Results -->
        <div class="results-container" id="resultsContainer">
            <button class="back-btn" onclick="resetSearch()">‚Üê New Search</button>

            <!-- ML Insights Panel (populated by displayMLInsights) -->
            <div class="ml-insights-panel" id="mlInsightsPanel" style="display: none;"></div>

            <div class="results-summary" id="resultsSummary"></div>

            <div id="personsList"></div>
        </div>

        <!-- Saved People Section -->
        <div class="saved-people-section" id="savedPeopleSection">
            <button class="back-btn" onclick="toggleSavedPeople()">‚Üê Back to Search</button>

            <div class="results-summary">
                <h2>üìÅ Saved People</h2>
                <p id="savedPeopleSummary">Manage your saved search results</p>
                <div style="margin-top: 15px;">
                    <button onclick="exportSavedPeople('json')" style="background: rgba(0, 149, 255, 0.2); border: 1px solid #0095ff; color: #fff; padding: 10px 20px; border-radius: 8px; cursor: pointer; margin-right: 10px; font-weight: 600;">
                        üì• Export as JSON
                    </button>
                    <button onclick="exportSavedPeople('csv')" style="background: rgba(76, 175, 80, 0.2); border: 1px solid #4CAF50; color: #fff; padding: 10px 20px; border-radius: 8px; cursor: pointer; font-weight: 600;">
                        üì• Export as CSV
                    </button>
                </div>
            </div>

            <div id="savedPeopleList"></div>
        </div>
    </div>

    <script>
        // County Data
        const COUNTY_DATA = {
            'OH': ['Adams', 'Allen', 'Ashland', 'Ashtabula', 'Athens', 'Auglaize', 'Belmont', 'Brown', 'Butler', 'Carroll', 'Champaign', 'Clark', 'Clermont', 'Clinton', 'Columbiana', 'Coshocton', 'Crawford', 'Cuyahoga', 'Darke', 'Defiance', 'Delaware', 'Erie', 'Fairfield', 'Fayette', 'Franklin', 'Fulton', 'Gallia', 'Geauga', 'Greene', 'Guernsey', 'Hamilton', 'Hancock', 'Hardin', 'Harrison', 'Henry', 'Highland', 'Hocking', 'Holmes', 'Huron', 'Jackson', 'Jefferson', 'Knox', 'Lake', 'Lawrence', 'Licking', 'Logan', 'Lorain', 'Lucas', 'Madison', 'Mahoning', 'Marion', 'Medina', 'Meigs', 'Mercer', 'Miami', 'Monroe', 'Montgomery', 'Morgan', 'Morrow', 'Muskingum', 'Noble', 'Ottawa', 'Paulding', 'Perry', 'Pickaway', 'Pike', 'Portage', 'Preble', 'Putnam', 'Richland', 'Ross', 'Sandusky', 'Scioto', 'Seneca', 'Shelby', 'Stark', 'Summit', 'Trumbull', 'Tuscarawas', 'Union', 'Van Wert', 'Vinton', 'Warren', 'Washington', 'Wayne', 'Williams', 'Wood', 'Wyandot'],
            'PA': ['Adams', 'Allegheny', 'Armstrong', 'Beaver', 'Bedford', 'Berks', 'Blair', 'Bradford', 'Bucks', 'Butler', 'Cambria', 'Cameron', 'Carbon', 'Centre', 'Chester', 'Clarion', 'Clearfield', 'Clinton', 'Columbia', 'Crawford', 'Cumberland', 'Dauphin', 'Delaware', 'Elk', 'Erie', 'Fayette', 'Forest', 'Franklin', 'Fulton', 'Greene', 'Huntingdon', 'Indiana', 'Jefferson', 'Juniata', 'Lackawanna', 'Lancaster', 'Lawrence', 'Lebanon', 'Lehigh', 'Luzerne', 'Lycoming', 'McKean', 'Mercer', 'Mifflin', 'Monroe', 'Montgomery', 'Montour', 'Northampton', 'Northumberland', 'Perry', 'Philadelphia', 'Pike', 'Potter', 'Schuylkill', 'Snyder', 'Somerset', 'Sullivan', 'Susquehanna', 'Tioga', 'Union', 'Venango', 'Warren', 'Washington', 'Wayne', 'Westmoreland', 'Wyoming', 'York'],
            'WV': ['Barbour', 'Berkeley', 'Boone', 'Braxton', 'Brooke', 'Cabell', 'Calhoun', 'Clay', 'Doddridge', 'Fayette', 'Gilmer', 'Grant', 'Greenbrier', 'Hampshire', 'Hancock', 'Hardy', 'Harrison', 'Jackson', 'Jefferson', 'Kanawha', 'Lewis', 'Lincoln', 'Logan', 'Marion', 'Marshall', 'Mason', 'McDowell', 'Mercer', 'Mineral', 'Mingo', 'Monongalia', 'Monroe', 'Morgan', 'Nicholas', 'Ohio', 'Pendleton', 'Pleasants', 'Pocahontas', 'Preston', 'Putnam', 'Raleigh', 'Randolph', 'Ritchie', 'Roane', 'Summers', 'Taylor', 'Tucker', 'Tyler', 'Upshur', 'Wayne', 'Webster', 'Wetzel', 'Wirt', 'Wood', 'Wyoming']
        };

        function updateCountyOptions() {
            const countySelect = document.getElementById('county');
            const checkedStates = Array.from(document.querySelectorAll('.state-checkbox:checked')).map(cb => cb.value);

            countySelect.innerHTML = '';

            // County selection only works when exactly ONE state is selected
            if (checkedStates.length === 0) {
                countySelect.disabled = true;
                countySelect.innerHTML = '<option value="">Select one state first...</option>';
                return;
            } else if (checkedStates.length > 1) {
                countySelect.disabled = true;
                countySelect.innerHTML = '<option value="">County filter only works with one state selected</option>';
                return;
            }

            // Exactly one state selected - enable county dropdown
            const selectedState = checkedStates[0];

            if (!COUNTY_DATA[selectedState]) {
                countySelect.disabled = true;
                countySelect.innerHTML = '<option value="">No county data for this state</option>';
                return;
            }

            countySelect.disabled = false;
            const counties = COUNTY_DATA[selectedState];
            const allOption = document.createElement('option');
            allOption.value = '';
            allOption.textContent = `All ${counties.length} Counties in ${selectedState}`;
            countySelect.appendChild(allOption);

            counties.forEach(county => {
                const option = document.createElement('option');
                option.value = county;
                option.textContent = county + ' County';
                countySelect.appendChild(option);
            });
        }

        // Continue with existing people_finder.html JavaScript...
        // (I'll keep the full JS from the original file - just copy lines 870-1782)
    </script>
</body>
</html>
        const API_BASE = '/people_finder/api';

        // County Data by State
        const COUNTY_DATA = {
            'OH': ['Adams', 'Allen', 'Ashland', 'Ashtabula', 'Athens', 'Auglaize', 'Belmont', 'Brown', 'Butler', 'Carroll', 'Champaign', 'Clark', 'Clermont', 'Clinton', 'Columbiana', 'Coshocton', 'Crawford', 'Cuyahoga', 'Darke', 'Defiance', 'Delaware', 'Erie', 'Fairfield', 'Fayette', 'Franklin', 'Fulton', 'Gallia', 'Geauga', 'Greene', 'Guernsey', 'Hamilton', 'Hancock', 'Hardin', 'Harrison', 'Henry', 'Highland', 'Hocking', 'Holmes', 'Huron', 'Jackson', 'Jefferson', 'Knox', 'Lake', 'Lawrence', 'Licking', 'Logan', 'Lorain', 'Lucas', 'Madison', 'Mahoning', 'Marion', 'Medina', 'Meigs', 'Mercer', 'Miami', 'Monroe', 'Montgomery', 'Morgan', 'Morrow', 'Muskingum', 'Noble', 'Ottawa', 'Paulding', 'Perry', 'Pickaway', 'Pike', 'Portage', 'Preble', 'Putnam', 'Richland', 'Ross', 'Sandusky', 'Scioto', 'Seneca', 'Shelby', 'Stark', 'Summit', 'Trumbull', 'Tuscarawas', 'Union', 'Van Wert', 'Vinton', 'Warren', 'Washington', 'Wayne', 'Williams', 'Wood', 'Wyandot'],
            'PA': ['Adams', 'Allegheny', 'Armstrong', 'Beaver', 'Bedford', 'Berks', 'Blair', 'Bradford', 'Bucks', 'Butler', 'Cambria', 'Cameron', 'Carbon', 'Centre', 'Chester', 'Clarion', 'Clearfield', 'Clinton', 'Columbia', 'Crawford', 'Cumberland', 'Dauphin', 'Delaware', 'Elk', 'Erie', 'Fayette', 'Forest', 'Franklin', 'Fulton', 'Greene', 'Huntingdon', 'Indiana', 'Jefferson', 'Juniata', 'Lackawanna', 'Lancaster', 'Lawrence', 'Lebanon', 'Lehigh', 'Luzerne', 'Lycoming', 'McKean', 'Mercer', 'Mifflin', 'Monroe', 'Montgomery', 'Montour', 'Northampton', 'Northumberland', 'Perry', 'Philadelphia', 'Pike', 'Potter', 'Schuylkill', 'Snyder', 'Somerset', 'Sullivan', 'Susquehanna', 'Tioga', 'Union', 'Venango', 'Warren', 'Washington', 'Wayne', 'Westmoreland', 'Wyoming', 'York'],
            'WV': ['Barbour', 'Berkeley', 'Boone', 'Braxton', 'Brooke', 'Cabell', 'Calhoun', 'Clay', 'Doddridge', 'Fayette', 'Gilmer', 'Grant', 'Greenbrier', 'Hampshire', 'Hancock', 'Hardy', 'Harrison', 'Jackson', 'Jefferson', 'Kanawha', 'Lewis', 'Lincoln', 'Logan', 'Marion', 'Marshall', 'Mason', 'McDowell', 'Mercer', 'Mineral', 'Mingo', 'Monongalia', 'Monroe', 'Morgan', 'Nicholas', 'Ohio', 'Pendleton', 'Pleasants', 'Pocahontas', 'Preston', 'Putnam', 'Raleigh', 'Randolph', 'Ritchie', 'Roane', 'Summers', 'Taylor', 'Tucker', 'Tyler', 'Upshur', 'Wayne', 'Webster', 'Wetzel', 'Wirt', 'Wood', 'Wyoming']
        };

        // Update county dropdown when state changes
        function updateCountyOptions() {
            const stateSelect = document.getElementById('state');
            const countySelect = document.getElementById('county');
            const selectedState = stateSelect.value;

            // Clear existing options
            countySelect.innerHTML = '';

            if (!selectedState || !COUNTY_DATA[selectedState]) {
                countySelect.disabled = true;
                countySelect.innerHTML = '<option value="">Select state first...</option>';
                return;
            }

            // Enable county select
            countySelect.disabled = false;

            // Add "All Counties" option with actual count
            const allOption = document.createElement('option');
            allOption.value = '';
            const counties = COUNTY_DATA[selectedState];
            allOption.textContent = `All ${counties.length} Counties in ${selectedState}`;
            countySelect.appendChild(allOption);

            // Add counties for selected state
            counties.forEach(county => {
                const option = document.createElement('option');
                option.value = county;
                option.textContent = county + ' County';
                countySelect.appendChild(option);
            });
        }

        // ============================================
        // ML ACTIVATION SYSTEM
        // ============================================

        let mlEnabled = false;
        let mlAvailable = false;

        async function checkMLAvailability() {
            /**
             * Check if ML packages are installed on the backend
             * This makes an API call to test ML availability
             */
            try {
                // Check if we can import ML models (backend check would be better)
                // For now, we'll assume ML is available if user toggles it on
                // In production, you'd make an API call here
                mlAvailable = true;
                return true;
            } catch (error) {
                console.log('ML packages not available:', error);
                mlAvailable = false;
                return false;
            }
        }

        function toggleMLActivation() {
            /**
             * Toggle ML/NLP features on/off
             * Triggers beam animation and perimeter border
             */
            const leverContainer = document.getElementById('mlLeverContainer');
            const statusText = document.getElementById('mlStatusText');
            const perimeterBorder = document.getElementById('mlPerimeterBorder');
            const activationBeam = document.getElementById('activationBeam');

            // Toggle ML state
            mlEnabled = !mlEnabled;

            // Save preference to localStorage
            localStorage.setItem('mlEnabled', mlEnabled);

            if (mlEnabled) {
                // ACTIVATE ML
                leverContainer.classList.add('active');
                statusText.textContent = 'ACTIVE';

                // Trigger beam animation
                activationBeam.classList.remove('animating');
                void activationBeam.offsetWidth; // Force reflow to restart animation
                activationBeam.classList.add('animating');

                // Show perimeter border after beam completes
                setTimeout(() => {
                    perimeterBorder.classList.add('active');
                }, 1500); // Match beam animation duration

                // Show notification
                showNotification('üß† ML/NLP Core Activated - AI features enabled', 'success');

                console.log('‚úì ML/NLP Features: ACTIVE');
            } else {
                // DEACTIVATE ML
                leverContainer.classList.remove('active');
                statusText.textContent = 'STANDBY';
                perimeterBorder.classList.remove('active');

                // Show notification
                showNotification('ML/NLP Core Deactivated - Using fallback methods', 'info');

                console.log('‚úì ML/NLP Features: STANDBY');
            }
        }

        function initializeMLSystem() {
            /**
             * Initialize ML system on page load
             * Check availability and restore saved preference
             */
            checkMLAvailability().then(available => {
                mlAvailable = available;

                // Restore saved preference
                const savedMLState = localStorage.getItem('mlEnabled');
                if (savedMLState === 'true') {
                    // Auto-activate ML if previously enabled
                    toggleMLActivation();
                }

                // If ML not available, show warning
                if (!available) {
                    const leverContainer = document.getElementById('mlLeverContainer');
                    const statusText = document.getElementById('mlStatusText');

                    // Add unavailable indicator (optional - for now ML is always "available" in UI)
                    // leverContainer.classList.add('ml-unavailable');
                    // statusText.textContent = 'UNAVAILABLE';
                }
            });
        }

        // Initialize ML system on page load
        document.addEventListener('DOMContentLoaded', () => {
            initializeMLSystem();
            initializeDatasetSystem();
        });

        // ============================================
        // DATASET INTELLIGENCE SYSTEM
        // ============================================

        let datasetIntelligenceEnabled = false;

        function toggleDatasetIntelligence() {
            /**
             * Toggle Dataset Intelligence on/off
             * When enabled, searches query historical datasets for temporal patterns
             */
            const leverContainer = document.getElementById('datasetLeverContainer');
            const statusText = document.getElementById('datasetStatusText');

            // Toggle state
            datasetIntelligenceEnabled = !datasetIntelligenceEnabled;

            // Save preference to localStorage
            localStorage.setItem('datasetIntelligenceEnabled', datasetIntelligenceEnabled);

            if (datasetIntelligenceEnabled) {
                // ENGAGE DATASETS
                leverContainer.classList.add('active');
                statusText.textContent = 'ONLINE';

                // Show notification
                showNotification('üìä Dataset Intelligence Engaged - Historical data active', 'success');

                console.log('‚úì Dataset Intelligence: ONLINE');
                console.log('  ‚Üí System will query historical records');
                console.log('  ‚Üí Temporal pattern detection enabled');
            } else {
                // DISENGAGE DATASETS
                leverContainer.classList.remove('active');
                statusText.textContent = 'OFFLINE';

                // Show notification
                showNotification('Dataset Intelligence Offline - Real-time search only', 'info');

                console.log('‚úì Dataset Intelligence: OFFLINE');
            }
        }

        function initializeDatasetSystem() {
            /**
             * Initialize Dataset system on page load
             * Restore saved preference
             */
            const savedDatasetState = localStorage.getItem('datasetIntelligenceEnabled');
            if (savedDatasetState === 'true') {
                // Auto-engage if previously enabled
                toggleDatasetIntelligence();
            }
        }

        // ============================================
        // API Key Management (localStorage)
        // ============================================

        function loadApiKeys() {
            const googleApiKey = localStorage.getItem('googleApiKey') || '';
            const googleSearchEngineId = localStorage.getItem('googleSearchEngineId') || '';
            const numverifyApiKey = localStorage.getItem('numverifyApiKey') || '';

            document.getElementById('googleApiKey').value = googleApiKey;
            document.getElementById('googleSearchEngineId').value = googleSearchEngineId;
            document.getElementById('numverifyApiKey').value = numverifyApiKey;

            updateApiStatus('google', googleApiKey && googleSearchEngineId);
            updateApiStatus('numverify', numverifyApiKey);
        }

        function updateApiStatus(apiName, isConfigured) {
            const statusDiv = document.getElementById(apiName + 'Status');
            const statusText = document.getElementById(apiName + 'StatusText');

            if (isConfigured) {
                statusDiv.className = 'api-status configured';
                if (apiName === 'google') {
                    statusText.textContent = '‚úì Configured - Enhanced web searches enabled';
                } else {
                    statusText.textContent = '‚úì Configured - Enhanced phone validation enabled';
                }
            } else {
                statusDiv.className = 'api-status not-configured';
                if (apiName === 'google') {
                    statusText.textContent = 'Not configured - using DuckDuckGo fallback';
                } else {
                    statusText.textContent = 'Not configured - using area code lookup only';
                }
            }
        }

        function openSettings() {
            loadApiKeys();
            document.getElementById('settingsModal').classList.add('active');
        }

        function closeSettings() {
            document.getElementById('settingsModal').classList.remove('active');
        }

        function saveSettings() {
            const googleApiKey = document.getElementById('googleApiKey').value.trim();
            const googleSearchEngineId = document.getElementById('googleSearchEngineId').value.trim();
            const numverifyApiKey = document.getElementById('numverifyApiKey').value.trim();

            // Save to localStorage
            localStorage.setItem('googleApiKey', googleApiKey);
            localStorage.setItem('googleSearchEngineId', googleSearchEngineId);
            localStorage.setItem('numverifyApiKey', numverifyApiKey);

            // Update status
            updateApiStatus('google', googleApiKey && googleSearchEngineId);
            updateApiStatus('numverify', numverifyApiKey);

            alert('‚úì Settings saved! API keys are stored locally in your browser.');
            closeSettings();
        }

        // Close modal when clicking outside
        document.addEventListener('DOMContentLoaded', function() {
            const modal = document.getElementById('settingsModal');
            modal.addEventListener('click', function(e) {
                if (e.target === modal) {
                    closeSettings();
                }
            });
        });

        // Track if a search is currently running
        let searchInProgress = false;

        // Form submission with real-time SSE progress
        document.getElementById('searchForm').addEventListener('submit', async (e) => {
            e.preventDefault();

            // Prevent multiple simultaneous searches
            if (searchInProgress) {
                addToSearchLog('‚ö†Ô∏è Search already in progress. Please wait...', 'warning');
                return;
            }

            // Collect all checked states
            const checkedStates = Array.from(document.querySelectorAll('.state-checkbox:checked')).map(cb => cb.value);
            const statesString = checkedStates.length > 0 ? checkedStates.join(',') : '';  // Send as comma-separated string

            const formData = {
                name: document.getElementById('name').value.trim(),
                phone: document.getElementById('phone').value.trim(),
                address: document.getElementById('address').value.trim(),
                state: statesString,  // Multiple states as comma-separated string (OH,PA,WV)
                county: document.getElementById('county').value.trim(),
                email: document.getElementById('email').value.trim(),

                // Include API keys from localStorage (optional)
                google_api_key: localStorage.getItem('googleApiKey') || '',
                google_search_engine_id: localStorage.getItem('googleSearchEngineId') || '',
                numverify_api_key: localStorage.getItem('numverifyApiKey') || '',

                // Include ML preference
                ml_enabled: mlEnabled,

                // Include Dataset Intelligence preference
                dataset_intelligence_enabled: datasetIntelligenceEnabled
            };

            // Validate at least one field
            if (!formData.name && !formData.phone && !formData.address && !formData.email) {
                showError('Please provide at least one search parameter (name, phone, address, or email).');
                return;
            }

            // Mark search as in progress
            searchInProgress = true;

            // Show progress with real-time updates
            document.getElementById('progressContainer').style.display = 'block';
            document.getElementById('searchBtn').disabled = true;
            document.getElementById('searchBtn').textContent = '‚è≥ Searching...';

            // Reset progress display and search log
            updateRealTimeProgress('Connecting to search engine...', 0);
            clearSearchLog();
            addToSearchLog('üöÄ Initializing search engine...', 'info');

            try {
                // Use Server-Sent Events for real-time progress
                await searchWithProgress(formData);
            } catch (error) {
                console.error('Search error:', error);
                showError('Search failed: ' + error.message);
                addToSearchLog('‚ùå Search failed: ' + error.message, 'error');
            } finally {
                // Always re-enable the button and mark search as complete
                searchInProgress = false;
                document.getElementById('searchBtn').disabled = false;
                document.getElementById('searchBtn').textContent = 'üîé Search';
            }
        });

        function searchWithProgress(formData) {
            return new Promise((resolve, reject) => {
                // Use regular fetch for POST with EventSource-like streaming
                fetch(`${API_BASE}/search/stream`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'text/event-stream'
                    },
                    body: JSON.stringify(formData)
                })
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Search failed');
                    }

                    const reader = response.body.getReader();
                    const decoder = new TextDecoder();
                    let buffer = '';

                    function processStream() {
                        reader.read().then(({done, value}) => {
                            if (done) {
                                // Stream ended
                                document.getElementById('searchBtn').disabled = false;
                                document.getElementById('searchBtn').textContent = 'üîé Search';
                                resolve();
                                return;
                            }

                            // Decode chunk
                            buffer += decoder.decode(value, {stream: true});

                            // Process complete SSE messages
                            const lines = buffer.split('\n\n');
                            buffer = lines.pop(); // Keep incomplete message in buffer

                            lines.forEach(line => {
                                if (line.startsWith('data: ')) {
                                    const jsonData = line.substring(6); // Remove "data: " prefix

                                    try {
                                        const message = JSON.parse(jsonData);

                                        if (message.type === 'progress') {
                                            // Real-time progress update
                                            updateRealTimeProgress(message.message, message.percent);
                                            addToSearchLog(message.message, 'progress');
                                        } else if (message.type === 'result') {
                                            // Final results received
                                            updateRealTimeProgress('Search complete!', 100);
                                            addToSearchLog('‚úÖ Search complete! Processing results...', 'success');
                                            setTimeout(() => {
                                                document.getElementById('progressContainer').style.display = 'none';
                                                displayResults(message.data);
                                            }, 500);
                                        } else if (message.type === 'error') {
                                            // Error occurred
                                            showError(message.message);
                                            addToSearchLog('‚ùå Error: ' + message.message, 'error');
                                            document.getElementById('progressContainer').style.display = 'none';
                                            document.getElementById('searchBtn').disabled = false;
                                            document.getElementById('searchBtn').textContent = 'üîé Search';
                                        }
                                    } catch (e) {
                                        console.error('Failed to parse SSE message:', e);
                                    }
                                }
                            });

                            // Continue reading
                            processStream();
                        });
                    }

                    processStream();
                })
                .catch(error => {
                    reject(error);
                });
            });
        }

        function updateRealTimeProgress(message, percent) {
            /**
             * Update progress bars with REAL-TIME updates from backend.
             * Shows actual search operations as they happen.
             */

            // Update progress bar width
            const progress1 = document.getElementById('progress1');
            const progress2 = document.getElementById('progress2');

            // Determine which progress bar to update based on percentage
            if (percent <= 60) {
                // Official sources phase (0-60%)
                const officialPercent = (percent / 60) * 100;
                progress1.style.width = officialPercent + '%';
                progress1.textContent = message;
                progress2.style.width = '0%';
                progress2.textContent = 'Waiting...';
            } else if (percent <= 90) {
                // Web sources phase (60-90%)
                progress1.style.width = '100%';
                progress1.textContent = 'Official sources complete ‚úì';
                const webPercent = ((percent - 60) / 30) * 100;
                progress2.style.width = webPercent + '%';
                progress2.textContent = message;
            } else {
                // Final aggregation (90-100%)
                progress1.style.width = '100%';
                progress1.textContent = 'Official sources complete ‚úì';
                progress2.style.width = '100%';
                progress2.textContent = message;
            }
        }

        function clearSearchLog() {
            /**
             * Clear the search log display
             */
            const searchLog = document.getElementById('searchLog');
            if (searchLog) {
                searchLog.innerHTML = '';
            }
        }

        function escapeHtml(text) {
            /**
             * Escape HTML to prevent injection and display issues
             */
            if (!text) return '';
            const div = document.createElement('div');
            div.textContent = String(text);
            return div.innerHTML;
        }

        function addToSearchLog(message, type = 'info') {
            /**
             * Add a message to the search log display (terminal-style live view)
             * Types: 'info', 'progress', 'success', 'error', 'warning'
             */
            const searchLog = document.getElementById('searchLog');
            if (!searchLog) return;

            const timestamp = new Date().toLocaleTimeString('en-US', { hour12: false });
            const logEntry = document.createElement('div');
            logEntry.style.marginBottom = '2px';
            logEntry.style.padding = '3px 6px';
            logEntry.style.fontFamily = "'Courier New', 'Consolas', monospace";
            logEntry.style.fontSize = '0.82rem';
            logEntry.style.lineHeight = '1.3';
            logEntry.style.whiteSpace = 'pre-wrap';
            logEntry.style.wordBreak = 'break-word';

            // Set colors based on type (terminal-style)
            let color, prefix;
            switch (type) {
                case 'success':
                    color = '#4caf50';
                    prefix = '‚úì';
                    break;
                case 'error':
                    color = '#f44336';
                    prefix = '‚úó';
                    break;
                case 'warning':
                    color = '#ff9800';
                    prefix = '‚ö†';
                    break;
                case 'progress':
                    color = '#00c8ff';
                    prefix = '‚ñ∏';
                    break;
                default: // info
                    color = '#8ab4f8';
                    prefix = '‚Ä¢';
            }

            logEntry.style.color = color;

            // Escape HTML to prevent script injection
            const safeMessage = escapeHtml(message);

            logEntry.innerHTML = `<span style="color: #666; opacity: 0.7;">${timestamp}</span> ${prefix} ${safeMessage}`;

            searchLog.appendChild(logEntry);

            // Auto-scroll to bottom (smooth)
            const container = searchLog.parentElement;
            container.scrollTop = container.scrollHeight;

            // Keep only last 150 entries to prevent memory issues
            while (searchLog.children.length > 150) {
                searchLog.removeChild(searchLog.firstChild);
            }
        }
        
        // Store search results globally to avoid JSON embedding issues
        let currentSearchResults = null;

        function displayMLInsights(mlInsights) {
            /**
             * Display ML insights panel with user-friendly summaries
             */
            const panel = document.getElementById('mlInsightsPanel');

            if (!mlInsights || !mlInsights.ml_enabled) {
                // ML not enabled - hide panel
                panel.style.display = 'none';
                return;
            }

            // ML is enabled - show insights
            panel.style.display = 'block';

            const insights = [];

            // Name matching insights
            if (mlInsights.name_matches_checked > 0) {
                const method = mlInsights.semantic_matching_used ? 'Semantic AI' : 'Fuzzy Matching';
                insights.push(`
                    <div class="ml-insight-item">
                        <span class="ml-insight-icon">üîç</span>
                        <span class="ml-insight-text">Name matching performed using <strong>${method}</strong></span>
                        <span class="ml-insight-badge">${mlInsights.name_matches_checked} comparisons</span>
                    </div>
                `);
            }

            // ML verified persons
            if (mlInsights.ml_verified_persons > 0) {
                insights.push(`
                    <div class="ml-insight-item">
                        <span class="ml-insight-icon">‚úì</span>
                        <span class="ml-insight-text">Merged duplicate records using AI similarity detection</span>
                        <span class="ml-insight-badge">${mlInsights.ml_verified_persons} verified</span>
                    </div>
                `);
            }

            // Address normalization
            if (mlInsights.addresses_normalized > 0) {
                insights.push(`
                    <div class="ml-insight-item">
                        <span class="ml-insight-icon">üè†</span>
                        <span class="ml-insight-text">Addresses parsed and normalized using ML</span>
                        <span class="ml-insight-badge">${mlInsights.addresses_normalized} processed</span>
                    </div>
                `);
            }

            // Semantic matching explanation
            if (mlInsights.semantic_matching_used) {
                insights.push(`
                    <div class="ml-insight-item">
                        <span class="ml-insight-icon">üí°</span>
                        <span class="ml-insight-text">AI detected name variations (e.g., "Bill" = "William", typos, nicknames)</span>
                        <span class="ml-insight-badge">Sentence-BERT</span>
                    </div>
                `);
            }

            // Default message if no specific insights
            if (insights.length === 0) {
                insights.push(`
                    <div class="ml-disabled-message">
                        ML features are available but no ML-enhanced data was found in this search.
                    </div>
                `);
            }

            panel.innerHTML = `
                <h3>
                    <span class="brain-icon">üß†</span>
                    ML Insights
                </h3>
                ${insights.join('')}
            `;
        }

        function displayResults(results) {
            // Store results globally
            currentSearchResults = results;

            document.querySelector('.search-card').style.display = 'none';
            document.getElementById('resultsContainer').style.display = 'block';

            // Display ML Insights (if available)
            if (results.ml_insights) {
                displayMLInsights(results.ml_insights);
            }

            // Summary
            const summary = document.getElementById('resultsSummary');
            summary.innerHTML = `
                <h2>Search Results</h2>
                <p><strong>${results.total_persons_found}</strong> potential matches found</p>
                <p>Searched: ${new Date(results.search_timestamp).toLocaleString()}</p>
            `;

            // Persons list
            const personsList = document.getElementById('personsList');
            personsList.innerHTML = '';

            results.persons.forEach((person, index) => {
                const personCard = createPersonCard(person, index);
                personsList.appendChild(personCard);
            });
        }
        
        function createPersonCard(person, index) {
            const card = document.createElement('div');
            card.className = 'person-card';
            card.id = `person-${index}`;

            const confidenceClass = person.overall_confidence >= 70 ? 'high' :
                                  person.overall_confidence >= 40 ? 'medium' : 'low';

            // Extract location info for badge
            const locations = extractLocations(person);
            const locationBadge = locations.length > 0 ?
                `<span class="person-location-badge">${locations.join(', ')}</span>` : '';

            // Check if already saved
            const savedPeople = getSavedPeople();
            const personId = generatePersonId(person);
            const isSaved = savedPeople.some(p => p.id === personId);

            card.innerHTML = `
                <div class="person-header">
                    <div>
                        <div class="person-name">
                            ${person.name || 'Unknown'}
                            ${locationBadge}
                        </div>
                    </div>
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <button class="save-person-btn ${isSaved ? 'saved' : ''}"
                                id="save-btn-${index}"
                                onclick="event.stopPropagation(); savePersonByIndex(${index})">
                            ${isSaved ? '‚≠ê Saved' : 'üíæ Save'}
                        </button>
                        <div class="confidence-badge confidence-${confidenceClass}">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <span>${Math.round(person.overall_confidence)}% Match</span>
                                ${person.merged_from_sources ? '<span style="font-size: 0.7rem;">üß† ML</span>' : ''}
                            </div>
                            <div class="confidence-progress-bar">
                                <div class="confidence-progress-fill" style="width: ${person.overall_confidence}%"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="person-summary">
                    <div class="summary-item">
                        <div class="summary-label">Phone Numbers</div>
                        <div class="summary-value">${person.organized_data.phone_numbers.length || 'None'}</div>
                    </div>
                    <div class="summary-item">
                        <div class="summary-label">Addresses</div>
                        <div class="summary-value">${person.organized_data.addresses.length || 'None'}</div>
                    </div>
                    <div class="summary-item">
                        <div class="summary-label">Emails</div>
                        <div class="summary-value">${person.organized_data.emails.length || 'None'}</div>
                    </div>
                    <div class="summary-item">
                        <div class="summary-label">Public Records</div>
                        <div class="summary-value">${person.organized_data.public_records.length || 'None'}</div>
                    </div>
                </div>

                <div class="person-details" id="details-${index}">
                    ${createDetailedView(person)}
                </div>
            `;

            // Toggle details on click
            card.addEventListener('click', (e) => {
                if (!e.target.closest('.detail-tabs') && !e.target.closest('.save-person-btn')) {
                    const details = document.getElementById(`details-${index}`);
                    details.classList.toggle('active');
                }
            });

            return card;
        }

        function extractLocations(person) {
            const locations = new Set();

            // From addresses
            person.organized_data.addresses?.forEach(addr => {
                const stateMatch = addr.full_address?.match(/\b([A-Z]{2})\b/);
                if (stateMatch) locations.add(stateMatch[1]);
            });

            // From county records
            person.organized_data.county_records?.forEach(record => {
                if (record.state) locations.add(record.state);
            });

            return Array.from(locations).slice(0, 3); // Max 3 locations
        }
        
        function createDetailedView(person) {
            try {
                // Safely access nested properties
                const phoneNumbers = person?.organized_data?.phone_numbers || [];
                const addresses = person?.organized_data?.addresses || [];
                const emails = person?.organized_data?.emails || [];
                const publicRecords = person?.organized_data?.public_records || [];
                const countyRecords = person?.organized_data?.county_records || [];
                const federalRecords = person?.organized_data?.federal_records || [];
                const associates = person?.associates || [];

            return `
                <div class="detail-tabs">
                    <button class="detail-tab active" onclick="showTab(event, 'phones')">üìû Phone Numbers</button>
                    <button class="detail-tab" onclick="showTab(event, 'addresses')">üè† Addresses</button>
                    <button class="detail-tab" onclick="showTab(event, 'emails')">üìß Emails</button>
                    <button class="detail-tab" onclick="showTab(event, 'associates')">üë• Associates</button>
                    <button class="detail-tab" onclick="showTab(event, 'records')">üìÅ Public Records</button>
                    <button class="detail-tab" onclick="showTab(event, 'social')">üåê Social Media</button>
                </div>

                <div class="detail-content active" data-tab="phones">
                    ${createPhonesList(phoneNumbers)}
                </div>
                <div class="detail-content" data-tab="addresses">
                    ${createAddressesList(addresses)}
                </div>
                <div class="detail-content" data-tab="emails">
                    ${createEmailsList(emails)}
                </div>
                <div class="detail-content" data-tab="associates">
                    ${createAssociatesList(associates)}
                </div>
                <div class="detail-content" data-tab="records">
                    ${createPublicRecordsDisplay(publicRecords, countyRecords, federalRecords)}
                </div>
                <div class="detail-content" data-tab="social">
                    ${createSocialList(person?.organized_data?.social_media || [])}
                </div>
            `;
            } catch (error) {
                console.error('Error creating detailed view:', error);
                return `<div style="padding: 20px; color: #f44336;">
                    <p>Error displaying details. Please try refreshing the search.</p>
                </div>`;
            }
        }
        
        function createPhonesList(phones) {
            try {
                if (!phones || !phones.length) return '<p style="color: #8ab4f8; padding: 20px;">No phone numbers found</p>';

                return '<div style="padding: 10px;">' + phones.map(phone => {
                    const confidenceColor = phone?.confidence_percent >= 70 ? '#4CAF50' :
                                          phone?.confidence_percent >= 40 ? '#FFA726' : '#f44336';
                    const lineTypeIcon = phone?.is_voip ? 'üåê' : 'üì±';
                    const suspiciousFlag = phone?.is_suspicious ? '<span style="color: #f44336; font-weight: bold;"> ‚ö†Ô∏è SUSPICIOUS</span>' : '';

                    return `
                    <div style="background: rgba(0, 149, 255, 0.05); border-left: 3px solid ${confidenceColor}; padding: 15px; margin-bottom: 15px; border-radius: 5px;">
                        <div style="font-size: 1.2em; font-weight: bold; color: #00c8ff; margin-bottom: 8px;">
                            ${lineTypeIcon} ${escapeHtml(phone?.number) || 'Unknown'}${suspiciousFlag}
                        </div>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 10px; margin-top: 10px;">
                            <div>
                                <strong style="color: #8ab4f8;">Carrier:</strong>
                                <span style="color: #fff;">${escapeHtml(phone?.carrier) || 'Unknown'}</span>
                            </div>
                            <div>
                                <strong style="color: #8ab4f8;">Line Type:</strong>
                                <span style="color: #fff;">${escapeHtml(phone?.line_type) || 'Unknown'}</span>
                            </div>
                            <div>
                                <strong style="color: #8ab4f8;">Location:</strong>
                                <span style="color: #fff;">${escapeHtml(phone?.location?.city || phone?.area_code || 'Unknown')}, ${escapeHtml(phone?.location?.state || '')}</span>
                            </div>
                            <div>
                                <strong style="color: #8ab4f8;">Confidence:</strong>
                                <span style="color: ${confidenceColor}; font-weight: bold;">${phone?.confidence_percent || 0}%</span>
                            </div>
                        </div>
                        ${phone?.sources && phone.sources.length ? `
                        <div style="margin-top: 10px; font-size: 0.9em;">
                            <strong style="color: #8ab4f8;">Sources:</strong>
                            <span style="color: #aaa;">${phone.sources.join(', ')}</span>
                        </div>` : ''}
                    </div>
                `}).join('') + '</div>';
            } catch (error) {
                console.error('Error creating phones list:', error);
                return '<p style="color: #f44336;">Error displaying phone numbers</p>';
            }
        }

        function createAddressesList(addresses) {
            try {
                if (!addresses || !addresses.length) return '<p style="color: #8ab4f8; padding: 20px;">No addresses found</p>';

                return '<div style="padding: 10px;">' + addresses.map(addr => {
                    const confidenceColor = addr?.confidence_percent >= 70 ? '#4CAF50' :
                                          addr?.confidence_percent >= 40 ? '#FFA726' : '#f44336';
                    const addressTypeIcon = addr?.is_po_box ? 'üìÆ' :
                                          addr?.address_type === 'business' ? 'üè¢' : 'üè†';
                    const poBoxFlag = addr?.is_po_box ? '<span style="color: #FFA726;"> (PO Box)</span>' : '';

                    return `
                    <div style="background: rgba(0, 149, 255, 0.05); border-left: 3px solid ${confidenceColor}; padding: 15px; margin-bottom: 15px; border-radius: 5px;">
                        <div style="font-size: 1.2em; font-weight: bold; color: #00c8ff; margin-bottom: 8px;">
                            ${addressTypeIcon} ${escapeHtml(addr?.full_address) || 'Unknown address'}${poBoxFlag}
                        </div>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 10px; margin-top: 10px;">
                            ${addr?.city ? `
                            <div>
                                <strong style="color: #8ab4f8;">City:</strong>
                                <span style="color: #fff;">${escapeHtml(addr.city)}</span>
                            </div>` : ''}
                            ${addr?.state ? `
                            <div>
                                <strong style="color: #8ab4f8;">State:</strong>
                                <span style="color: #fff;">${escapeHtml(addr.state)}</span>
                            </div>` : ''}
                            ${addr?.zip_code ? `
                            <div>
                                <strong style="color: #8ab4f8;">ZIP Code:</strong>
                                <span style="color: #fff;">${escapeHtml(addr.zip_code)}</span>
                            </div>` : ''}
                            <div>
                                <strong style="color: #8ab4f8;">Type:</strong>
                                <span style="color: #fff;">${escapeHtml(addr?.address_type || 'Unknown')}</span>
                            </div>
                            <div>
                                <strong style="color: #8ab4f8;">Confidence:</strong>
                                <span style="color: ${confidenceColor}; font-weight: bold;">${addr?.confidence_percent || 0}%</span>
                            </div>
                        </div>
                        ${addr?.sources && addr.sources.length ? `
                        <div style="margin-top: 10px; font-size: 0.9em;">
                            <strong style="color: #8ab4f8;">Sources:</strong>
                            <span style="color: #aaa;">${addr.sources.join(', ')}</span>
                        </div>` : ''}
                    </div>
                `}).join('') + '</div>';
            } catch (error) {
                console.error('Error creating addresses list:', error);
                return '<p style="color: #f44336;">Error displaying addresses</p>';
            }
        }

        function createEmailsList(emails) {
            try {
                if (!emails || !emails.length) return '<p style="color: #8ab4f8; padding: 20px;">No emails found</p>';

                return '<div style="padding: 10px;">' + emails.map(email => {
                    const confidenceColor = email?.confidence_percent >= 70 ? '#4CAF50' :
                                          email?.confidence_percent >= 40 ? '#FFA726' : '#f44336';
                    const emailTypeIcon = email?.is_business_email ? 'üíº' :
                                        email?.is_disposable ? 'üóëÔ∏è' : 'üìß';
                    const disposableFlag = email?.is_disposable ? '<span style="color: #f44336; font-weight: bold;"> ‚ö†Ô∏è DISPOSABLE</span>' : '';

                    return `
                    <div style="background: rgba(0, 149, 255, 0.05); border-left: 3px solid ${confidenceColor}; padding: 15px; margin-bottom: 15px; border-radius: 5px;">
                        <div style="font-size: 1.2em; font-weight: bold; color: #00c8ff; margin-bottom: 8px;">
                            ${emailTypeIcon} ${escapeHtml(email?.email) || 'Unknown email'}${disposableFlag}
                        </div>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 10px; margin-top: 10px;">
                            <div>
                                <strong style="color: #8ab4f8;">Provider:</strong>
                                <span style="color: #fff;">${escapeHtml(email?.provider) || 'Unknown'}</span>
                            </div>
                            <div>
                                <strong style="color: #8ab4f8;">Type:</strong>
                                <span style="color: #fff;">${escapeHtml(email?.email_type) || 'Unknown'}</span>
                            </div>
                            ${email?.format_type && email.format_type !== 'unknown' ? `
                            <div>
                                <strong style="color: #8ab4f8;">Format:</strong>
                                <span style="color: #fff;">${escapeHtml(email.format_type)}</span>
                            </div>` : ''}
                            <div>
                                <strong style="color: #8ab4f8;">Domain Valid:</strong>
                                <span style="color: ${email?.is_valid_domain ? '#4CAF50' : '#f44336'};">${email?.is_valid_domain ? '‚úì Yes' : '‚úó No'}</span>
                            </div>
                            <div>
                                <strong style="color: #8ab4f8;">Confidence:</strong>
                                <span style="color: ${confidenceColor}; font-weight: bold;">${email?.confidence_percent || 0}%</span>
                            </div>
                        </div>
                        ${email?.sources && email.sources.length ? `
                        <div style="margin-top: 10px; font-size: 0.9em;">
                            <strong style="color: #8ab4f8;">Sources:</strong>
                            <span style="color: #aaa;">${email.sources.join(', ')}</span>
                        </div>` : ''}
                    </div>
                `}).join('') + '</div>';
            } catch (error) {
                console.error('Error creating emails list:', error);
                return '<p style="color: #f44336;">Error displaying emails</p>';
            }
        }

        function createAssociatesList(associates) {
            try {
                if (!associates || !associates.length) {
                    return '<p style="color: #8ab4f8; padding: 20px;">No known associates found</p>';
                }

                return `
                    <div style="padding: 10px;">
                        <div style="background: rgba(0, 149, 255, 0.1); padding: 15px; border-radius: 10px; margin-bottom: 20px;">
                            <h3 style="color: #00c8ff; margin: 0 0 10px 0;">üë• Known Associates (${associates.length})</h3>
                            <p style="color: #8ab4f8; margin: 0; font-size: 0.95em;">
                                People connected through shared addresses, phone numbers, or public records
                            </p>
                        </div>
                        ${associates.map(assoc => {
                            const relationshipTypes = assoc?.relationship_types || [];
                            const relationshipIcons = {
                                'same_address': 'üè†',
                                'same_phone': 'üìû',
                                'same_last_name': 'üë®‚Äçüë©‚Äçüëß‚Äçüë¶',
                                'property_co_owner': 'üè°',
                                'age_parent_child': 'üë®‚Äçüëß',
                                'business_associate': 'üíº'
                            };

                            const relationshipColors = {
                                'same_address': '#4CAF50',
                                'same_phone': '#2196F3',
                                'same_last_name': '#9C27B0',
                                'property_co_owner': '#FF9800',
                                'age_parent_child': '#E91E63',
                                'business_associate': '#00BCD4'
                            };

                            return `
                            <div style="background: rgba(0, 149, 255, 0.05); border-left: 3px solid #00c8ff; padding: 15px; margin-bottom: 15px; border-radius: 5px;">
                                <div style="font-size: 1.2em; font-weight: bold; color: #00c8ff; margin-bottom: 10px;">
                                    ${escapeHtml(assoc?.name) || 'Unknown'}
                                </div>

                                ${relationshipTypes.length > 0 ? `
                                <div style="margin-top: 10px;">
                                    <strong style="color: #8ab4f8;">Connection Types:</strong>
                                    <div style="display: flex; flex-wrap: wrap; gap: 8px; margin-top: 8px;">
                                        ${relationshipTypes.map(relType => {
                                            const icon = relationshipIcons[relType] || 'üîó';
                                            const color = relationshipColors[relType] || '#00c8ff';
                                            const label = relType.replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase());
                                            return `
                                            <span style="background: ${color}22; color: ${color}; padding: 6px 12px; border-radius: 15px; font-size: 0.85em; border: 1px solid ${color}44;">
                                                ${icon} ${label}
                                            </span>
                                            `;
                                        }).join('')}
                                    </div>
                                </div>
                                ` : ''}

                                ${assoc?.shared_data ? `
                                <div style="margin-top: 12px; padding-top: 12px; border-top: 1px solid rgba(0, 149, 255, 0.2);">
                                    <strong style="color: #8ab4f8;">Shared Information:</strong>
                                    <ul style="margin: 8px 0 0 0; padding-left: 20px; color: #aaa;">
                                        ${assoc.shared_data.addresses && assoc.shared_data.addresses.length ?
                                            `<li>Addresses: ${assoc.shared_data.addresses.map(a => escapeHtml(a)).join(', ')}</li>` : ''}
                                        ${assoc.shared_data.phones && assoc.shared_data.phones.length ?
                                            `<li>Phones: ${assoc.shared_data.phones.map(p => escapeHtml(p)).join(', ')}</li>` : ''}
                                        ${assoc.shared_data.properties && assoc.shared_data.properties.length ?
                                            `<li>Properties: ${assoc.shared_data.properties.map(p => escapeHtml(p)).join(', ')}</li>` : ''}
                                    </ul>
                                </div>
                                ` : ''}
                            </div>
                            `;
                        }).join('')}
                    </div>
                `;
            } catch (error) {
                console.error('Error creating associates list:', error);
                return '<p style="color: #f44336;">Error displaying associates</p>';
            }
        }

        function createPublicRecordsDisplay(legacyRecords, countyRecords, federalRecords) {
            try {
                let html = '';

            // County Records Table
            if (countyRecords && countyRecords.length > 0) {
                html += `
                    <h3 style="color: #0095ff; margin-top: 0;">County Records (${countyRecords.length})</h3>
                    <div style="overflow-x: auto;">
                        <table style="width: 100%; border-collapse: collapse; margin-bottom: 30px;">
                            <thead>
                                <tr style="background: rgba(0, 149, 255, 0.1); text-align: left;">
                                    <th style="padding: 12px; border: 1px solid rgba(0, 149, 255, 0.3);">Search Name</th>
                                    <th style="padding: 12px; border: 1px solid rgba(0, 149, 255, 0.3);">County</th>
                                    <th style="padding: 12px; border: 1px solid rgba(0, 149, 255, 0.3);">State</th>
                                    <th style="padding: 12px; border: 1px solid rgba(0, 149, 255, 0.3);">Record Type</th>
                                    <th style="padding: 12px; border: 1px solid rgba(0, 149, 255, 0.3);">Source</th>
                                    <th style="padding: 12px; border: 1px solid rgba(0, 149, 255, 0.3);">Action</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${countyRecords.map(record => `
                                    <tr style="border-bottom: 1px solid rgba(0, 149, 255, 0.2);">
                                        <td style="padding: 10px; border: 1px solid rgba(0, 149, 255, 0.2);"><strong>${record.search_name || 'N/A'}</strong></td>
                                        <td style="padding: 10px; border: 1px solid rgba(0, 149, 255, 0.2);">${record.county}</td>
                                        <td style="padding: 10px; border: 1px solid rgba(0, 149, 255, 0.2);">${record.state}</td>
                                        <td style="padding: 10px; border: 1px solid rgba(0, 149, 255, 0.2);">
                                            ${record.type === 'county_court_records' ? '‚öñÔ∏è Court Records' : 'üè† Property Records'}
                                        </td>
                                        <td style="padding: 10px; border: 1px solid rgba(0, 149, 255, 0.2); font-size: 0.9em;">
                                            ${record.source}
                                            ${record.notes ? '<br><small style="color: #8ab4f8;">' + record.notes + '</small>' : ''}
                                        </td>
                                        <td style="padding: 10px; border: 1px solid rgba(0, 149, 255, 0.2);">
                                            <a href="${record.url}" target="_blank"
                                               style="color: #0095ff; text-decoration: none; font-weight: 600;">
                                                üîó Search Portal
                                            </a>
                                        </td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                `;
            }

            // Federal Records by Category
            if (federalRecords && Object.keys(federalRecords).length > 0) {
                html += `<h3 style="color: #0095ff; margin-top: 20px;">Federal Records</h3>`;

                // Federal Courts
                if (federalRecords.federal_courts && federalRecords.federal_courts.length > 0) {
                    html += createFederalRecordsTable('‚öñÔ∏è Federal Courts', federalRecords.federal_courts);
                }

                // Criminal Records
                if (federalRecords.criminal_records && federalRecords.criminal_records.length > 0) {
                    html += createFederalRecordsTable('üö® Criminal & Background', federalRecords.criminal_records);
                }

                // Licenses
                if (federalRecords.licenses && federalRecords.licenses.length > 0) {
                    html += createFederalRecordsTable('üìú Federal Licenses', federalRecords.licenses);
                }

                // Professional Licenses
                if (federalRecords.professional_licenses && federalRecords.professional_licenses.length > 0) {
                    html += createFederalRecordsTable('üëî Professional Licenses', federalRecords.professional_licenses);
                }

                // Vital Records
                if (federalRecords.vital_records && federalRecords.vital_records.length > 0) {
                    html += createFederalRecordsTable('üìã Vital Records', federalRecords.vital_records);
                }

                // Property Records
                if (federalRecords.property_records && federalRecords.property_records.length > 0) {
                    html += createFederalRecordsTable('üèõÔ∏è Federal Property', federalRecords.property_records);
                }
            }

            // Legacy records (fallback for old format)
            if ((!countyRecords || countyRecords.length === 0) &&
                (!federalRecords || Object.keys(federalRecords).length === 0) &&
                legacyRecords && legacyRecords.length > 0) {
                html += '<p style="color: #8ab4f8;">Found ' + legacyRecords.length + ' public record sources. Details available in search results.</p>';
            }

            if (!html) {
                html = '<p style="color: #8ab4f8;">No public records found. Try searching with different parameters.</p>';
            }

            return html;
            } catch (error) {
                console.error('Error creating public records display:', error);
                return '<p style="color: #f44336;">Error displaying public records. Please try refreshing the search.</p>';
            }
        }

        function createFederalRecordsTable(title, records) {
            return `
                <h4 style="color: #8ab4f8; margin-top: 15px; margin-bottom: 10px;">${title}</h4>
                <div style="overflow-x: auto;">
                    <table style="width: 100%; border-collapse: collapse; margin-bottom: 20px;">
                        <thead>
                            <tr style="background: rgba(0, 149, 255, 0.1); text-align: left;">
                                <th style="padding: 10px; border: 1px solid rgba(0, 149, 255, 0.3);">Search Name</th>
                                <th style="padding: 10px; border: 1px solid rgba(0, 149, 255, 0.3);">Source</th>
                                <th style="padding: 10px; border: 1px solid rgba(0, 149, 255, 0.3);">Description</th>
                                <th style="padding: 10px; border: 1px solid rgba(0, 149, 255, 0.3);">Cost</th>
                                <th style="padding: 10px; border: 1px solid rgba(0, 149, 255, 0.3);">Action</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${records.map(record => `
                                <tr style="border-bottom: 1px solid rgba(0, 149, 255, 0.2);">
                                    <td style="padding: 10px; border: 1px solid rgba(0, 149, 255, 0.2);"><strong>${record.search_name || 'N/A'}</strong></td>
                                    <td style="padding: 10px; border: 1px solid rgba(0, 149, 255, 0.2);">${record.source}</td>
                                    <td style="padding: 10px; border: 1px solid rgba(0, 149, 255, 0.2); font-size: 0.9em;">
                                        ${record.description}
                                        ${record.notes ? '<br><small style="color: #8ab4f8;">' + record.notes + '</small>' : ''}
                                    </td>
                                    <td style="padding: 10px; border: 1px solid rgba(0, 149, 255, 0.2);">
                                        ${record.free ? '<span style="color: #4caf50; font-weight: 600;">FREE</span>' :
                                          '<span style="color: #ff9800;">PAID</span>'}
                                    </td>
                                    <td style="padding: 10px; border: 1px solid rgba(0, 149, 255, 0.2);">
                                        <a href="${record.url}" target="_blank"
                                           style="color: #0095ff; text-decoration: none; font-weight: 600;">
                                            üîó Search
                                        </a>
                                    </td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                </div>
            `;
        }
        
        function createSocialList(social) {
            try {
                if (!social || !social.length) return '<p style="color: #8ab4f8;">No social media profiles found</p>';

            return `
                <div style="overflow-x: auto;">
                    <table style="width: 100%; border-collapse: collapse;">
                        <thead>
                            <tr style="background: rgba(0, 149, 255, 0.1); text-align: left;">
                                <th style="padding: 12px; border: 1px solid rgba(0, 149, 255, 0.3);">Profile Name</th>
                                <th style="padding: 12px; border: 1px solid rgba(0, 149, 255, 0.3);">Platform</th>
                                <th style="padding: 12px; border: 1px solid rgba(0, 149, 255, 0.3);">URL</th>
                                <th style="padding: 12px; border: 1px solid rgba(0, 149, 255, 0.3);">Details</th>
                                <th style="padding: 12px; border: 1px solid rgba(0, 149, 255, 0.3);">Status</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${social.map(link => `
                                <tr style="border-bottom: 1px solid rgba(0, 149, 255, 0.2);">
                                    <td style="padding: 10px; border: 1px solid rgba(0, 149, 255, 0.2);"><strong>${link?.profile_name || extractProfileName(link?.url) || 'Unknown'}</strong></td>
                                    <td style="padding: 10px; border: 1px solid rgba(0, 149, 255, 0.2);">
                                        <span style="padding: 4px 10px; background: rgba(0, 149, 255, 0.2); border-radius: 12px; font-size: 0.85em;">
                                            ${link?.platform || detectPlatform(link?.url)}
                                        </span>
                                    </td>
                                    <td style="padding: 10px; border: 1px solid rgba(0, 149, 255, 0.2); max-width: 300px; overflow: hidden; text-overflow: ellipsis;">
                                        <a href="${link?.url || '#'}" target="_blank" style="color: #0095ff; text-decoration: none;">${link?.url || 'N/A'}</a>
                                    </td>
                                    <td style="padding: 10px; border: 1px solid rgba(0, 149, 255, 0.2); font-size: 0.9em; color: #8ab4f8;">
                                        ${link?.snippet || link?.description || 'No details available'}
                                    </td>
                                    <td style="padding: 10px; border: 1px solid rgba(0, 149, 255, 0.2); text-align: center;">
                                        <span style="padding: 4px 8px; background: rgba(255, 152, 0, 0.2); color: #ff9800; border-radius: 8px; font-size: 0.75em; font-weight: 600;">
                                            VERIFY
                                        </span>
                                    </td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                </div>
            `;
            } catch (error) {
                console.error('Error creating social media list:', error);
                return '<p style="color: #f44336;">Error displaying social media profiles</p>';
            }
        }

        function extractProfileName(url) {
            // Try to extract profile name from URL
            if (!url) return null;

            // Match common patterns like /username or @username
            const patterns = [
                /\/([^\/\?]+)\/?$/,  // Last part of URL
                /@([a-zA-Z0-9_]+)/,   // @username
                /user\/([^\/\?]+)/,   // /user/username
                /profile\/([^\/\?]+)/ // /profile/username
            ];

            for (const pattern of patterns) {
                const match = url.match(pattern);
                if (match && match[1] && match[1].length > 0 && match[1].length < 50) {
                    return match[1];
                }
            }
            return null;
        }

        function detectPlatform(url) {
            // Detect platform from URL
            if (!url) return 'Unknown';

            const lowerUrl = url.toLowerCase();
            if (lowerUrl.includes('facebook.com') || lowerUrl.includes('fb.com')) return 'Facebook';
            if (lowerUrl.includes('twitter.com') || lowerUrl.includes('x.com')) return 'Twitter/X';
            if (lowerUrl.includes('instagram.com')) return 'Instagram';
            if (lowerUrl.includes('linkedin.com')) return 'LinkedIn';
            if (lowerUrl.includes('tiktok.com')) return 'TikTok';
            if (lowerUrl.includes('youtube.com')) return 'YouTube';
            if (lowerUrl.includes('snapchat.com')) return 'Snapchat';
            if (lowerUrl.includes('pinterest.com')) return 'Pinterest';
            if (lowerUrl.includes('reddit.com')) return 'Reddit';
            if (lowerUrl.includes('github.com')) return 'GitHub';

            return 'Web Profile';
        }
        
        function showTab(event, tabName) {
            const detailsContainer = event.target.closest('.person-details');
            
            // Update tabs
            detailsContainer.querySelectorAll('.detail-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // Update content
            detailsContainer.querySelectorAll('.detail-content').forEach(content => {
                content.classList.remove('active');
            });
            detailsContainer.querySelector(`[data-tab="${tabName}"]`).classList.add('active');
        }
        
        function showError(message) {
            // Hide search form but keep it available
            document.querySelector('.search-card').style.display = 'block';

            // Remove any existing error alerts
            const existingAlert = document.querySelector('.error-alert');
            if (existingAlert) {
                existingAlert.remove();
            }

            // Determine error type and provide helpful suggestions
            let suggestion = '';
            if (message.includes('at least one')) {
                suggestion = 'Try filling out at least one field, or click "Try Example" to test with sample data.';
            } else if (message.includes('timeout') || message.includes('network')) {
                suggestion = 'Check your internet connection and try again.';
            } else if (message.includes('API') || message.includes('rate limit')) {
                suggestion = 'You may have hit the free tier limit. Try again later or configure API keys in Settings.';
            } else if (message.includes('404') || message.includes('not found')) {
                suggestion = 'The search service may be temporarily unavailable. Try again in a moment.';
            } else {
                suggestion = 'Try searching with different criteria or fewer fields.';
            }

            // Create error alert
            const errorAlert = document.createElement('div');
            errorAlert.className = 'error-alert';
            errorAlert.innerHTML = `
                <strong>‚ö†Ô∏è Search Error</strong>
                <p>${message}</p>
                <p style="margin-top: 8px; color: #d32f2f; font-weight: 400;">
                    <em>Suggestion:</em> ${suggestion}
                </p>
            `;

            // Insert after search form
            const searchCard = document.querySelector('.search-card');
            searchCard.appendChild(errorAlert);

            // Auto-remove after 10 seconds
            setTimeout(() => {
                errorAlert.style.transition = 'opacity 0.5s';
                errorAlert.style.opacity = '0';
                setTimeout(() => errorAlert.remove(), 500);
            }, 10000);

            // Scroll to error
            errorAlert.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }
        
        function resetSearch() {
            document.querySelector('.search-card').style.display = 'block';
            document.getElementById('resultsContainer').style.display = 'none';
            document.getElementById('searchForm').reset();
            clearValidation();
        }

        // ============================================
        // EXAMPLE DATA & INPUT VALIDATION
        // ============================================

        function fillExampleData() {
            // Fill form with example data for quick testing
            document.getElementById('name').value = 'John A Smith';
            document.getElementById('phone').value = '(555) 123-4567';
            document.getElementById('address').value = '123 Main Street, Columbus';
            document.getElementById('email').value = 'john.smith@example.com';

            // Check Ohio state checkbox as example
            const ohioCheckbox = document.querySelector('.state-checkbox[value="OH"]');
            if (ohioCheckbox) {
                ohioCheckbox.checked = true;
            }

            // Trigger county update
            updateCountyOptions();

            // Show visual feedback
            const formInputs = document.querySelectorAll('#searchForm input, #searchForm select');
            formInputs.forEach(input => {
                if (input.value) {
                    input.classList.add('valid');
                    input.classList.remove('invalid');
                }
            });

            // Brief notification
            const btn = event.target;
            const originalText = btn.textContent;
            btn.textContent = '‚úÖ Example Loaded!';
            btn.style.background = 'linear-gradient(135deg, #4CAF50 0%, #45a049 100%)';

            setTimeout(() => {
                btn.textContent = originalText;
                btn.style.background = '';
            }, 2000);
        }

        // Real-time input validation
        document.addEventListener('DOMContentLoaded', () => {
            const nameInput = document.getElementById('name');
            const phoneInput = document.getElementById('phone');
            const emailInput = document.getElementById('email');

            nameInput?.addEventListener('input', (e) => {
                const value = e.target.value.trim();
                if (value.length >= 2 && /^[a-zA-Z\s]+$/.test(value)) {
                    e.target.classList.add('valid');
                    e.target.classList.remove('invalid');
                } else if (value.length > 0) {
                    e.target.classList.add('invalid');
                    e.target.classList.remove('valid');
                } else {
                    e.target.classList.remove('valid', 'invalid');
                }
            });

            phoneInput?.addEventListener('input', (e) => {
                const value = e.target.value.replace(/\D/g, '');
                if (value.length === 10 || value.length === 11) {
                    e.target.classList.add('valid');
                    e.target.classList.remove('invalid');
                } else if (value.length > 0) {
                    e.target.classList.add('invalid');
                    e.target.classList.remove('valid');
                } else {
                    e.target.classList.remove('valid', 'invalid');
                }
            });

            emailInput?.addEventListener('input', (e) => {
                const value = e.target.value.trim();
                const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                if (emailRegex.test(value)) {
                    e.target.classList.add('valid');
                    e.target.classList.remove('invalid');
                } else if (value.length > 0) {
                    e.target.classList.add('invalid');
                    e.target.classList.remove('valid');
                } else {
                    e.target.classList.remove('valid', 'invalid');
                }
            });
        });

        function clearValidation() {
            const formInputs = document.querySelectorAll('#searchForm input, #searchForm select');
            formInputs.forEach(input => {
                input.classList.remove('valid', 'invalid');
            });
        }

        // ============================================
        // API SETTINGS MODAL
        // ============================================

        function openSettings() {
            // Load saved API keys from localStorage
            document.getElementById('googleApiKey').value = localStorage.getItem('googleApiKey') || '';
            document.getElementById('googleSearchEngineId').value = localStorage.getItem('googleSearchEngineId') || '';
            document.getElementById('numverifyApiKey').value = localStorage.getItem('numverifyApiKey') || '';

            // Show modal
            document.getElementById('settingsModal').style.display = 'block';
        }

        function closeSettings() {
            document.getElementById('settingsModal').style.display = 'none';
        }

        function saveSettings() {
            // Get values from form
            const googleApiKey = document.getElementById('googleApiKey').value.trim();
            const googleSearchEngineId = document.getElementById('googleSearchEngineId').value.trim();
            const numverifyApiKey = document.getElementById('numverifyApiKey').value.trim();

            // Save to localStorage
            if (googleApiKey) {
                localStorage.setItem('googleApiKey', googleApiKey);
            } else {
                localStorage.removeItem('googleApiKey');
            }

            if (googleSearchEngineId) {
                localStorage.setItem('googleSearchEngineId', googleSearchEngineId);
            } else {
                localStorage.removeItem('googleSearchEngineId');
            }

            if (numverifyApiKey) {
                localStorage.setItem('numverifyApiKey', numverifyApiKey);
            } else {
                localStorage.removeItem('numverifyApiKey');
            }

            // Show success message
            alert('API keys saved successfully! They will be used for future searches.');

            // Close modal
            closeSettings();
        }

        function clearSettings() {
            if (confirm('Are you sure you want to clear all API keys?')) {
                localStorage.removeItem('googleApiKey');
                localStorage.removeItem('googleSearchEngineId');
                localStorage.removeItem('numverifyApiKey');

                document.getElementById('googleApiKey').value = '';
                document.getElementById('googleSearchEngineId').value = '';
                document.getElementById('numverifyApiKey').value = '';

                alert('All API keys cleared.');
            }
        }

        // Close modal when clicking outside of it
        window.onclick = function(event) {
            const modal = document.getElementById('settingsModal');
            if (event.target == modal) {
                closeSettings();
            }
        }

        // ============================================
        // SAVE/BOOKMARK FUNCTIONALITY
        // ============================================

        function savePersonByIndex(personIndex) {
            // Get person from global results instead of passing through HTML
            if (!currentSearchResults || !currentSearchResults.persons || !currentSearchResults.persons[personIndex]) {
                showNotification('Error: Could not find person data', 'error');
                return;
            }

            const personData = currentSearchResults.persons[personIndex];
            savePerson(personIndex, personData);
        }

        function savePerson(personIndex, personData) {
            try {
                const savedPeople = getSavedPeople();
                const personId = generatePersonId(personData);

                // Check if already saved
                const existingIndex = savedPeople.findIndex(p => p.id === personId);

                if (existingIndex >= 0) {
                    // Already saved - remove it (toggle)
                    savedPeople.splice(existingIndex, 1);
                    localStorage.setItem('savedPeople', JSON.stringify(savedPeople));
                    updateSaveButton(personIndex, false);
                    showNotification('Person removed from saved list', 'info');
                } else {
                    // Save it
                    savedPeople.push({
                        id: personId,
                        data: personData,
                        savedAt: new Date().toISOString()
                    });
                    localStorage.setItem('savedPeople', JSON.stringify(savedPeople));
                    updateSaveButton(personIndex, true);
                    showNotification('Person saved successfully!', 'success');
                }

                updateSavedCount();
            } catch (error) {
                console.error('Save error:', error);
                showNotification('Error saving person: ' + error.message, 'error');
            }
        }

        function getSavedPeople() {
            const saved = localStorage.getItem('savedPeople');
            return saved ? JSON.parse(saved) : [];
        }

        function generatePersonId(person) {
            // Generate unique ID based on name + primary contact info
            const name = person.name || '';
            const phone = person.organized_data?.phone_numbers?.[0]?.number || '';
            const email = person.organized_data?.emails?.[0]?.email || '';
            return `${name}-${phone}-${email}`.toLowerCase().replace(/\s/g, '');
        }

        function updateSaveButton(personIndex, isSaved) {
            const btn = document.querySelector(`#save-btn-${personIndex}`);
            if (btn) {
                if (isSaved) {
                    btn.classList.add('saved');
                    btn.textContent = '‚≠ê Saved';
                } else {
                    btn.classList.remove('saved');
                    btn.textContent = 'üíæ Save';
                }
            }
        }

        function updateSavedCount() {
            const count = getSavedPeople().length;
            const countElem = document.getElementById('savedCount');
            if (countElem) {
                countElem.textContent = count;
            }
        }

        function toggleSavedPeople() {
            const savedSection = document.getElementById('savedPeopleSection');
            const searchCard = document.querySelector('.search-card');
            const resultsContainer = document.getElementById('resultsContainer');

            if (savedSection.classList.contains('active')) {
                // Hide saved, show search
                savedSection.classList.remove('active');
                searchCard.style.display = 'block';
            } else {
                // Show saved, hide search
                savedSection.classList.add('active');
                searchCard.style.display = 'none';
                resultsContainer.style.display = 'none';
                displaySavedPeople();
            }
        }

        function displaySavedPeople() {
            const savedPeople = getSavedPeople();
            const container = document.getElementById('savedPeopleList');

            if (savedPeople.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 40px; color: #8ab4f8;">
                        <p style="font-size: 1.2rem; margin-bottom: 10px;">No saved people yet</p>
                        <p>Save people from search results to access them here later!</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = savedPeople.map((saved, index) => {
                const person = saved.data;
                const savedDate = new Date(saved.savedAt).toLocaleDateString();

                return `
                    <div class="person-card" style="position: relative;">
                        <button onclick="removeSavedPerson('${saved.id}')"
                                style="position: absolute; top: 15px; right: 15px; background: rgba(244, 67, 54, 0.2); border: 1px solid #f44336; color: #fff; padding: 8px 15px; border-radius: 5px; cursor: pointer; font-weight: 600;">
                            üóëÔ∏è Remove
                        </button>

                        <div class="person-header">
                            <div>
                                <div class="person-name">${person.name || 'Unknown'}</div>
                                <small style="color: #8ab4f8;">Saved on ${savedDate}</small>
                            </div>
                            <div class="confidence-badge confidence-${person.overall_confidence >= 70 ? 'high' : person.overall_confidence >= 40 ? 'medium' : 'low'}">
                                ${Math.round(person.overall_confidence)}% Match
                            </div>
                        </div>

                        <div class="person-summary">
                            <div class="summary-item">
                                <div class="summary-label">Phone Numbers</div>
                                <div class="summary-value">${person.organized_data.phone_numbers?.length || 0}</div>
                            </div>
                            <div class="summary-item">
                                <div class="summary-label">Addresses</div>
                                <div class="summary-value">${person.organized_data.addresses?.length || 0}</div>
                            </div>
                            <div class="summary-item">
                                <div class="summary-label">Emails</div>
                                <div class="summary-value">${person.organized_data.emails?.length || 0}</div>
                            </div>
                            <div class="summary-item">
                                <div class="summary-label">Public Records</div>
                                <div class="summary-value">${person.organized_data.public_records?.length || 0}</div>
                            </div>
                        </div>

                        <div class="person-details active" id="saved-details-${index}">
                            ${createDetailedView(person)}
                        </div>
                    </div>
                `;
            }).join('');
        }

        function removeSavedPerson(personId) {
            if (confirm('Remove this person from saved list?')) {
                const savedPeople = getSavedPeople();
                const filtered = savedPeople.filter(p => p.id !== personId);
                localStorage.setItem('savedPeople', JSON.stringify(filtered));
                updateSavedCount();
                displaySavedPeople();
                showNotification('Person removed from saved list', 'info');
            }
        }

        function exportSavedPeople(format) {
            const savedPeople = getSavedPeople();

            if (savedPeople.length === 0) {
                alert('No saved people to export!');
                return;
            }

            if (format === 'json') {
                const dataStr = JSON.stringify(savedPeople, null, 2);
                const blob = new Blob([dataStr], { type: 'application/json' });
                downloadFile(blob, `saved_people_${Date.now()}.json`);
            } else if (format === 'csv') {
                const csv = convertSavedToCSV(savedPeople);
                const blob = new Blob([csv], { type: 'text/csv' });
                downloadFile(blob, `saved_people_${Date.now()}.csv`);
            }
        }

        function convertSavedToCSV(savedPeople) {
            const headers = ['Name', 'Confidence', 'Phones', 'Addresses', 'Emails', 'Saved Date'];
            const rows = savedPeople.map(saved => {
                const p = saved.data;
                return [
                    p.name || 'Unknown',
                    Math.round(p.overall_confidence) + '%',
                    p.organized_data.phone_numbers?.map(ph => ph.number).join('; ') || 'None',
                    p.organized_data.addresses?.map(a => a.full_address).join('; ') || 'None',
                    p.organized_data.emails?.map(e => e.email).join('; ') || 'None',
                    new Date(saved.savedAt).toLocaleDateString()
                ];
            });

            return [headers, ...rows].map(row => row.map(cell => `"${cell}"`).join(',')).join('\n');
        }

        function downloadFile(blob, filename) {
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        function showNotification(message, type = 'success') {
            const notification = document.createElement('div');

            // Choose color based on type
            let background;
            if (type === 'success') {
                background = 'linear-gradient(135deg, #4CAF50, #45a049)';
            } else if (type === 'error') {
                background = 'linear-gradient(135deg, #f44336, #d32f2f)';
            } else if (type === 'info') {
                background = 'linear-gradient(135deg, #2196F3, #1976D2)';
            } else {
                background = 'linear-gradient(135deg, #2196F3, #1976D2)';
            }

            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: ${background};
                color: white;
                padding: 15px 25px;
                border-radius: 8px;
                box-shadow: 0 4px 15px rgba(0,0,0,0.3);
                z-index: 10000;
                font-weight: 600;
                animation: slideIn 0.3s ease-out;
                max-width: 400px;
                word-wrap: break-word;
            `;
            notification.textContent = message;
            document.body.appendChild(notification);

            setTimeout(() => {
                notification.style.animation = 'slideOut 0.3s ease-out';
                setTimeout(() => notification.remove(), 300);
            }, type === 'error' ? 5000 : 3000); // Errors stay longer
        }

        // Initialize saved count on page load
        document.addEventListener('DOMContentLoaded', () => {
            updateSavedCount();
        });
    </script>

    <style>
        @keyframes slideIn {
            from { transform: translateX(400px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        @keyframes slideOut {
            from { transform: translateX(0); opacity: 1; }
            to { transform: translateX(400px); opacity: 0; }
        }
    </style>

    <!-- API Settings Modal -->
    <div id="settingsModal" class="modal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeSettings()">&times;</span>
            <div class="modal-header">‚öôÔ∏è API Settings</div>
            <p class="modal-description">
                All API keys are <strong>optional</strong>. The app works great without them!
                API keys enhance results (verified data instead of estimates) and are stored only in your browser.
            </p>

            <!-- Google Custom Search API -->
            <div class="api-section">
                <h3>üîç Google Custom Search API (Optional)</h3>
                <p>Better web search quality. Free tier: 100 queries/day.</p>
                <p><small>Get free key at: <a href="https://developers.google.com/custom-search" target="_blank">developers.google.com/custom-search</a></small></p>

                <label style="color: #333; font-weight: 600; display: block; margin-top: 10px; margin-bottom: 5px;">API Key:</label>
                <input type="text" id="googleApiKey" placeholder="Enter Google API Key (optional)">

                <label style="color: #333; font-weight: 600; display: block; margin-top: 10px; margin-bottom: 5px;">Search Engine ID:</label>
                <input type="text" id="googleSearchEngineId" placeholder="Enter Custom Search Engine ID (optional)">
            </div>

            <!-- NumVerify Phone API -->
            <div class="api-section">
                <h3>üì± NumVerify Phone API (Optional)</h3>
                <p>Verified carrier info (AT&T, Verizon, etc.) and line type. Free tier: 250 lookups/month.</p>
                <p><small>Get free key at: <a href="https://numverify.com/" target="_blank">numverify.com</a></small></p>

                <label style="color: #333; font-weight: 600; display: block; margin-top: 10px; margin-bottom: 5px;">API Key:</label>
                <input type="text" id="numverifyApiKey" placeholder="Enter NumVerify API Key (optional)">
            </div>

            <!-- Info Box -->
            <div style="background: #e3f2fd; padding: 15px; border-radius: 8px; margin-top: 15px;">
                <strong style="color: #1976d2;">‚ÑπÔ∏è Without API Keys:</strong>
                <ul style="color: #666; margin-top: 10px; padding-left: 20px; line-height: 1.8;">
                    <li>DuckDuckGo web search (no API needed)</li>
                    <li>Built-in area code database (55 area codes)</li>
                    <li>Carrier hints via pattern analysis</li>
                    <li>All 210 county portals + 21 federal sources</li>
                </ul>
            </div>

            <!-- Modal Buttons -->
            <div class="modal-buttons">
                <button class="modal-btn modal-btn-secondary" onclick="clearSettings()">Clear All Keys</button>
                <button class="modal-btn modal-btn-secondary" onclick="closeSettings()">Cancel</button>
                <button class="modal-btn modal-btn-primary" onclick="saveSettings()">Save Settings</button>
            </div>
        </div>
    </div>
</body>
</html>
